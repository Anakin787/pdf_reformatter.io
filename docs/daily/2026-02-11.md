# 작업일지 — 2026-02-11 (화)

## 요약

PAGE 4+ 영역을 "문장별 정밀 대조 결과" 레이아웃으로 전면 재설계.  
카피킬러 PDF에서 추출한 비교 데이터를 초록(문헌 표절) / 주황(AI 유사도) 카드로 표시하도록 변경.

---

## 변경 파일

- `PDF_Reformatter.html`

---

## 상세 작업 내역

### 1. PAGE 4+ `v-if="false"` 주석 해제

- 기존에 `<template v-if="false">`로 숨겨져 있던 4페이지 이후 콘텐츠 영역을 활성화.
- `v-if="contentPages.length > 0"`으로 변경하여 분석 결과가 있을 때만 렌더링.

### 2. CSS — 비교 카드 스타일 전면 교체

**삭제된 스타일:**
- `.gpt-block`, `.citation-block`, `.normal-block` (기존 블록 기반 레이아웃)

**추가된 스타일:**
- `.comp-page-title`, `.comp-page-subtitle`, `.comp-divider` — 페이지 타이틀 영역
- `.comp-card`, `.comp-card-hdr`, `.comp-card-body`, `.comp-card-foot` — 좌우 2단 비교 카드 구조
- `.comp-badge`, `.comp-src-box`, `.comp-quote`, `.comp-db-title`, `.comp-match-badge` — 카드 내부 요소
- `.card-plag` (초록 테마) — 문헌 표절 카드
  - 헤더: teal (`#0d9488`), 배지: dark green (`#065f46`)
  - 강조 텍스트: `.hl` → 진한 초록 밑줄
- `.card-ai` (주황 테마) — AI 유사도 카드
  - 헤더: orange (`#ea580c`), 배지: dark orange (`#9a3412`)
  - 강조 텍스트: `.hl` → 진한 주황 밑줄

### 3. HTML 템플릿 — 문장별 대조 카드 레이아웃

**첫 페이지 (pIdx === 0):**
- 대제목: "문장별 정밀 대조 결과"
- 부제: "Original Text vs Reference Comparison"
- teal 그라디언트 디바이더

**각 비교 카드 구조:**
- **헤더 좌측:** "검사 문서 (Original Text)" + 페이지 번호 배지
- **헤더 우측:** "비교 문헌 (Reference Content)" 또는 "AI 유사도 (AI Similarity)" + 유사도% 배지
- **본문 좌측:** 원문 텍스트 (강조 부분 `<span class="hl">` 처리)
- **본문 우측 (문헌 표절):** CopyClean DB — 저자, 발행처, 일치 텍스트, 출처 참조
- **본문 우측 (AI 유사도):** AI Pattern Detection — 탐지 모델, 패턴 유형, 일치 텍스트
- **하단:** "원문 문헌 상세보기" / "결과에서 제외" / "Case Reference: CC-XXXX"

### 4. JS — `analyzeWithGemini` 프롬프트 수정

**이전:** 범용 블록 추출 (`blocks: [{type, text}]`)  
**이후:** 카피킬러 문장별 대조 데이터 추출 (`comparisons: [{type, pageNum, similarity, originalText, highlightedText, source, caseRef}]`)

- `type`: `"plagiarism"` (문헌 표절) / `"ai_similarity"` (AI 유사도)
- `source` 객체: `author`, `publisher`, `matchedText`, `fullReference`, `patternType`
- 브랜드 치환 규칙 유지 (카피킬러 → 카피클린)

### 5. JS — STEP 3.5 주석 해제 및 재작성

**이전:** 전체 주석 처리 (`/* ... */`)  
**이후:** 활성화 및 새 데이터 구조 적용

- 모든 PDF 페이지(1~maxPages)를 Gemini Vision AI로 분석
- `allComparisons` 배열에 비교 항목 수집
- `replaceBrand()` 적용 후 자동 케이스 번호 할당 (`CC-1001`, `CC-1002`, ...)
- 강조 텍스트 매칭 시 `<span class="hl">` 래핑 → `formattedOriginal` 생성
- 페이지당 2개씩 `contentPages`에 분배 (`ITEMS_PER_PAGE = 2`)

---

## 미변경 영역 (보호)

- PAGE 1~3 HTML 템플릿 및 관련 JS 데이터
- PDF 변환/다운로드 로직 (`downloadPDF`, `@media print` CSS)
- STEP 1~3 메타데이터 추출 및 텍스트 분석 흐름

---

## 참고

- 디자인 참조: 카피킬러 상세 결과 PDF의 문장별 대조 레이아웃
- 문헌 표절 = 초록색 계열 / AI 유사도 = 주황색 계열
