# 작업일지 — 2026-02-20 (금)

## 요약

GitHub Pages 배포 시 API 키 만료 방지를 위해 GitHub Actions 워크플로우 기반 시크릿/변수 주입 방식 도입. 다중 파일 업로드 및 순차 분석 큐 시스템, jsPDF 기반 자동 PDF 저장, 비교카드 시작 페이지 보정 등 다수 개선.

---

## 변경 파일

- `PDF_Reformatter.html`
- `README.md`
- `.github/workflows/deploy-pages.yml` (신규)

---

## 상세 작업 내역

### 1. API 키 시크릿/변수 주입 방식 전환

- 하드코딩된 Gemini API 키를 플레이스홀더 `__GEMINI_API_KEY__`로 교체
- GitHub Actions 배포 워크플로우에서 `secrets.GEMINI_API_KEY` 또는 `vars.GEMINI_API_KEY`를 `sed`로 치환
- GitHub가 코드 스캔으로 API 키를 탐지해 만료시키는 문제 해결

### 2. GitHub Actions Pages 배포 워크플로우 추가

- `.github/workflows/deploy-pages.yml` 신규 생성
- `main` 브랜치 push 또는 수동 트리거(`workflow_dispatch`) 시 자동 배포
- `actions/configure-pages@v4` → `actions/upload-pages-artifact@v3` → `actions/deploy-pages@v4` 파이프라인
- `.git`, `.github`, `docs`, `README.md` 등 불필요 파일 배포 제외

### 3. 다중 파일 업로드 및 순차 분석 큐

- `<input type="file">` 에 `multiple` 속성 추가
- `fileQueue` ref로 업로드된 파일 목록 관리 (`[{ file, price }]`)
- `status === 'queue'` 상태에서 파일별 서비스 가격 설정 UI 표시
- `startQueue()`로 큐 내 파일을 순차적으로 `processFile()` 호출
- 진행 표시: `(현재 / 전체)` 카운터

### 4. 비교카드 시작 페이지 보정

- 카피킬러 PDF 1~2페이지는 요약/표지이므로 비교카드 분석을 3페이지부터 시작하도록 변경
- `compStartPage = Math.min(3, maxPages)` 적용
- 진행률 텍스트도 비교카드 기준으로 표시

### 5. 카드 높이 조정

- `CARD_H = 200` → `240` (border, margin 포함 실제 높이 반영)

### 6. jsPDF 기반 자동 PDF 저장

- `autoSavePDF()` 함수 추가: jsPDF + html2canvas로 각 `.pdf-page`를 캡처 → JPEG 변환 → PDF 저장
- 분석 완료 후 800ms 대기 → 자동 다운로드
- `downloadPDF()`도 `autoSavePDF()` 호출로 통일 (기존 `window.print()` 대체)
- 실패 시 `window.print()` fallback

### 7. 파일명 기반 PDF 저장명

- 분석 완료 시 `document.title`을 업로드된 파일명(확장자 제거)으로 설정
- PDF 저장 시 해당 파일명 사용

### 8. README API 키 설정 안내 갱신

- GitHub Pages 배포: 시크릿/변수 등록 방법 안내
- 로컬 실행: 플레이스홀더 직접 교체 안내

---

## 미변경 영역 (보호)

- PAGE 1 진단 결과서 레이아웃 구조
- PAGE 2 프리미엄 솔루션 레이아웃 구조
- Gemini Vision API 호출 프롬프트 및 응답 파싱 로직
- 문장별 대조 카드 CSS 스타일 (card-plag, card-ai)
