# 작업일지 — 2026-02-14 (금)

## 요약

기존 PAGE 1(표지)과 PAGE 3(진단 결과서)를 단일 PAGE 1로 통합. Gemini API 키 교체, PAGE 3+ 카드 렌더링 버그 수정(DOM 측정 제거 → 고정 높이 기반), 통합된 PAGE 1 전반적 UI 정밀 조정(로고·헤더·여백·푸터·색상·링크·리포트ID·진단모델 등), 로고 배경 투명화 처리. API 키 보안 처리, 드래그 앤 드롭 PDF 업로드 추가, 표절률 차트 바 색상 동적 변경.

---

## 변경 파일

- `PDF_Reformatter.html`
- `origin.png` (로고 배경 투명화)

---

## 상세 작업 내역

### 1. PAGE 1·3 통합 (3페이지 → 2페이지 구조)

- **이전:** PAGE 1(표지) / PAGE 2(프리미엄 솔루션) / PAGE 3(진단 결과서) / PAGE 4+(문장별 대조)
- **이후:** PAGE 1(진단 결과서 통합) / PAGE 2(프리미엄 솔루션) / PAGE 3+(문장별 대조)
- 기존 PAGE 1 표지 제거, PAGE 3의 진단 결과서 내용을 새 PAGE 1로 승격
- 차트(표절률 비교), 종합 판정, 정밀 진단 결과 요약, 유사성 분포, 카테고리 비율, 진단 총평·제출 주의사항을 단일 페이지에 배치
- 페이지 번호 체계: `1 / N`, `2 / N`, `3 / N`... 으로 재정렬

### 2. Gemini API 키 교체

- 기존 키 유출로 인한 비활성화 → 새 API 키로 교체
- PAGE 3+ 미표시 원인이 API 키 문제였음을 확인

### 3. PAGE 3+ 카드 렌더링 버그 수정

- **증상:** 카드 헤더만 표시되고 본문 내용이 잘림
- **원인:** `pages.value = [1, 2]`를 `contentPages.value` 설정 전에 실행하면서 DOM 측정 시점에 `page-3` 요소가 존재하지 않아 카드 높이를 헤더 크기만큼만 측정
- **시도:** `nextTick()` 단일/이중, `setTimeout(300ms)` — 모두 실패
- **해결:** DOM 측정 로직 전체 제거, 고정 `CARD_H = 200`으로 페이지 분배 (원래 코드도 항상 fallback 200px를 사용하고 있었음)
- `pages.value = [1, 2]`를 분석 완료 후 마지막에 설정하도록 원래 흐름 복원

### 4. 로고 크기 확대 (PAGE 1)

- `height: 48px` → `62px` → `81px` (30%씩 2회 확대)

### 5. 푸터 텍스트 변경 (PAGE 1)

- **이전:** `CopyClean Document Verification Service` + `Generated on ~~`
- **이후:** 한국어 면책 고지문으로 교체
- 폰트 크기: `9px` → `7px`

### 6. 헤더 여백 조정 (PAGE 1)

- `.p3-header` padding-bottom: `15px` → `0px`
- `.p3-header` margin-bottom: `20px` → `8px`
- 헤더 정렬: `items-start` → `items-end` (제목·로고를 구분선 쪽에 정렬)
- 제목 영역에 `padding-bottom: 8px` 추가

### 7. 메타 정보 바 여백 확대 (PAGE 1)

- 상단 여백: `mt-4` → `mt-6`

### 8. 정밀 진단 결과 요약 여백 추가 (PAGE 1)

- 섹션에 `mt-2` 추가

### 9. 진단 총평·제출 주의사항 간격 확대 (PAGE 1)

- 섹션 상단: `mt-4` → `mt-6`
- 제목-내용 간격: `mb-2` → `mb-3`
- 진단 총평 항목 간: `space-y-2` → `space-y-3`
- 제출 주의사항 항목 간: `space-y-1.5` → `space-y-2.5`

### 10. 결제 링크 스타일 변경 (PAGE 2)

- 밑줄 제거 (`text-decoration: none`)
- 폰트 크기: `text-[10px]` → `text-xs`

### 11. 문장별 정밀 대조 결과 링크 클릭 가능 처리 (PAGE 4+)

- URL 요소에 `position: relative; z-index: 10; cursor: pointer` 추가

### 12. 리포트 ID 형식 변경

- **이전:** `CP-YYYYMMDD-XXXX`
- **이후:** `CC-XXXXXXXX` (8자리 랜덤 숫자)

### 13. 진단 모델 버전 고정

- `CopyClean AI 진단 엔진 v3.2` → `CopyClean AI v3.2`로 최종 확정

### 14. 발급일자 오늘 날짜 고정

- PDF 메타데이터 기반 날짜 오버라이드 제거, 항상 오늘 날짜 사용

### 15. 종합 판정 박스 텍스트 변경

- **이전:** "종합표절률 XX%로 기준 수치를..."
- **이후:** "AI 생성 유사 및 출처 대조 유사 비율이 XX%로 높게 분석되었습니다."

### 16. 카테고리 비율 바 색상 변경

- `bg-slate-800` → `bg-slate-500` (다크그레이로 연하게)

### 17. PDF 인쇄 배경 흰색 처리

- `@page { margin: 0; }` 추가하여 회색 배경 제거
- `size: A4` 제거 (Cursor 내장 브라우저 0KB 문제 방지)

### 18. 로고 배경 투명화

- Python Pillow로 `origin.png`의 밝은 픽셀(R,G,B > 230) 투명 처리
- CSS `mix-blend-mode: multiply` 제거 (Pillow 변환으로 불필요)

### 19. PDF 분석 페이지 제한

- `15` → `8` (테스트용) → `15` (복원)

### 20. API 키 보안 처리

- 루트 `PDF_Reformatter.html`의 하드코딩된 API 키를 플레이스홀더(`YOUR_GEMINI_API_KEY`)로 교체
- Git 저장소에 실제 키가 노출되지 않도록 처리

### 21. 드래그 앤 드롭 PDF 업로드 추가

- 기존 버튼 클릭 업로드에 드래그 앤 드롭 방식 추가
- `isDragging` ref로 드래그 중 시각적 피드백 (파란 테두리 + 배경)
- `handleFileUpload`에서 공통 `processFile()` 함수 분리
- `dragover`, `dragenter`, `dragleave`, `drop` 이벤트 바인딩

### 22. 표절률 차트 바 색상 동적 변경 (PAGE 1)

- **이전:** 모든 표절률에 빨간색(`#dc2626`) 고정
- **이후:** 표절률 기준 3단계 색상 분기
  - ≤15%: `#10b981` (초록/안전)
  - 16~30%: `#f97316` (주황/경고)
  - 31%+: `#dc2626` (빨강/위험)
- 바 색상, 퍼센트 라벨 텍스트, 초과 칩 배경 모두 동일 기준 적용

---

## 미변경 영역 (보호)

- PAGE 2 프리미엄 솔루션 레이아웃 구조
- PDF 변환/다운로드 로직 (`downloadPDF`, `@media print` CSS 기본 구조)
- STEP 1~3 메타데이터 추출 및 텍스트 분석 흐름
- 카드 높이 기반 동적 페이지 재배치 로직 (고정 CARD_H=200 기반)

---

## 참고

- PAGE 3+ 렌더링 문제의 근본 원인: 원래 코드도 DOM 측정에 실패하여 항상 fallback 200px를 사용하고 있었음. DOM 측정 코드를 제거하고 명시적으로 고정 높이를 사용하도록 변경하여 해결.
- `origin.png`: 배경 투명화 완료, 삭제 불가 (HTML에서 로고로 참조 중)
