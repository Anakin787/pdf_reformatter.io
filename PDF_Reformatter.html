<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CopyClean Expert Report System</title>
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PDF & Canvas Utils -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <!-- Chart.js (Page 3 차트용) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- QR Code Generator (Page 2 QR용) -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&family=Noto+Sans+KR:wght@300;400;500;700;900&display=swap');
        
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f1f5f9; color: #334155; }

        /* A4 Fixed Layout (794px x 1123px) */
        .pdf-page {
            width: 794px;
            height: 1123px;
            margin: 40px auto;
            background: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            position: relative;
            box-sizing: border-box;
            overflow: hidden;
            flex-shrink: 0;
        }

        /* Page 1: Standard Report Styles */
        .p1-header { border-bottom: 2px solid #334155; padding-bottom: 10px; margin-bottom: 20px; }
        .p1-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .p1-table th, .p1-table td { border: 1px solid #cbd5e1; padding: 6px 10px; vertical-align: middle; }
        .p1-table th { background: #e2e8f0; font-weight: 700; color: #1e293b; text-align: center; width: 120px; }
        .p1-table td { color: #334155; font-weight: 500; }
        
        /* Page 2: Premium Dark Styles (Moved from Page 3) */
        .p2-container { background-color: #0f172a; color: white; height: 100%; padding: 50px; position: relative; }
        .p2-card { background: #1e293b; border-radius: 16px; padding: 25px; border: 1px solid #334155; }
        .p2-highlight { background: #2563eb; color: white; padding: 5px 10px; border-radius: 4px; font-size: 10px; font-weight: 800; display: inline-block; margin-bottom: 10px; }
        
        /* Page 3: Diagnostic Styles (Moved from Page 2) */
        .p3-header { border-bottom: 1px solid #e2e8f0; padding-bottom: 15px; margin-bottom: 30px; }
        .verdict-box { border-radius: 12px; padding: 25px; text-align: center; }
        .verdict-danger { background: #fff1f2; border: 1px solid #fda4af; color: #be123c; }
        .verdict-safe { background: #f0fdf4; border: 1px solid #86efac; color: #15803d; }

        /* Page 4+: 문장별 정밀 대조 결과 Styles */
        .content-padding { padding: 28px 32px; display: flex; flex-direction: column; }
        .comp-page-title { font-size: 20px; font-weight: 900; color: #1e293b; letter-spacing: -0.5px; }
        .comp-page-subtitle { font-size: 11px; color: #94a3b8; margin-top: 2px; }
        .comp-divider { height: 2px; background: linear-gradient(to right, #0d9488, #14b8a6); margin: 8px 0 14px 0; border-radius: 2px; }
        .comp-card { border: 1.5px solid #e2e8f0; border-radius: 8px; overflow: hidden; margin-bottom: 18px; background: white; }
        .comp-card-hdr { display: flex; }
        .comp-card-hdr-l, .comp-card-hdr-r { flex: 1; padding: 6px 12px; display: flex; justify-content: space-between; align-items: center; font-size: 10px; font-weight: 700; }
        .comp-badge { padding: 2px 9px; border-radius: 999px; font-size: 9px; font-weight: 700; white-space: nowrap; }
        .comp-card-body { display: flex; }
        .comp-card-body-l { flex: 1; padding: 10px 12px; border-right: 1px solid #e2e8f0; font-size: 11px; line-height: 1.7; color: #334155; text-align: justify; }
        .comp-card-body-r { flex: 1; padding: 10px 12px; font-size: 10px; line-height: 1.6; color: #475569; display: flex; flex-direction: column; }
        .comp-src-box { background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 6px; padding: 6px 10px; margin: 5px 0; font-size: 9.5px; line-height: 1.6; }
        .comp-card-foot { display: flex; justify-content: space-between; align-items: center; padding: 4px 12px; border-top: 1px solid #e2e8f0; font-size: 9px; color: #94a3b8; }
        .comp-db-title { font-weight: 800; font-size: 11.5px; margin-bottom: 3px; color: #1e293b; }
        .comp-match-badge { display: inline-block; font-size: 8px; padding: 1px 8px; border-radius: 999px; font-weight: 600; }
        /* Green: 문헌 표절 */
        .card-plag .comp-card-hdr-l { background: #0d9488; color: white; }
        .card-plag .comp-card-hdr-r { background: #f0fdfa; color: #0d9488; border-left: 1px solid #ccfbf1; }
        .card-plag .comp-badge-l { background: #065f46; color: white; }
        .card-plag .comp-badge-r { background: #0d9488; color: white; }
        .card-plag .comp-quote { border-left: 3px solid #0d9488; padding: 5px 10px; margin: 5px 0; color: #115e59; font-size: 9.5px; line-height: 1.6; background: #f0fdfa; border-radius: 0 4px 4px 0; }
        .card-plag .hl { color: #065f46; font-weight: normal; text-decoration: underline; text-underline-offset: 2px; }
        .card-plag .comp-match-badge { background: #ccfbf1; color: #0d9488; }
        /* Orange: AI 유사도 */
        .card-ai .comp-card-hdr-l { background: #ea580c; color: white; }
        .card-ai .comp-card-hdr-r { background: #fff7ed; color: #ea580c; border-left: 1px solid #fed7aa; }
        .card-ai .comp-badge-l { background: #9a3412; color: white; }
        .card-ai .comp-badge-r { background: #ea580c; color: white; }
        .card-ai .comp-quote { border-left: 3px solid #ea580c; padding: 5px 10px; margin: 5px 0; color: #7c2d12; font-size: 9.5px; line-height: 1.6; background: #fff7ed; border-radius: 0 4px 4px 0; }
        .card-ai .hl { color: #9a3412; font-weight: normal; text-decoration: underline; text-underline-offset: 2px; }
        .card-ai .comp-match-badge { background: #fed7aa; color: #ea580c; }
        
        /* Utilities */
        .approval-box { position: absolute; top: 40px; right: 50px; border: 1px solid #94a3b8; background: white; z-index: 10; width: 80px; }
        .approval-table th, .approval-table td { border: 1px solid #94a3b8; text-align: center; padding: 2px; font-size: 10px; }
        .approval-space { height: 45px; }

        /* Hide during PDF generation */
        #hidden-area { position: absolute; left: -9999px; top: 0; }

        /* ★ 인쇄용 CSS - PDF 다운로드 시 사용 */
        @page {
            size: 794px 1123px;
            margin: 0;
        }
        @media print {
            html, body { margin: 0 !important; padding: 0 !important; background: white !important; width: 794px !important; }
            /* 배경색/그라디언트 강제 출력 */
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            /* nav 및 비-보고서 요소 숨김 */
            nav { display: none !important; }
            main { padding: 0 !important; margin: 0 !important; min-height: auto !important; }
            main > div:not(.flex) { display: none !important; }
            /* 페이지 간 간격 제거 + 페이지 나누기 */
            .flex.flex-col.gap-10 { gap: 0 !important; }
            .pdf-page {
                margin: 0 !important;
                box-shadow: none !important;
                page-break-after: always;
                page-break-inside: avoid;
                break-after: page;
                break-inside: avoid;
            }
            .pdf-page:last-child { page-break-after: auto; break-after: auto; }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Top Navigation -->
        <nav class="bg-slate-900 text-white px-6 py-4 sticky top-0 z-50 shadow-xl flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-indigo-600 rounded-lg flex items-center justify-center font-bold text-xl">C</div>
                <div>
                    <h1 class="text-lg font-bold">COPYCLEAN</h1>
                    <p class="text-[10px] text-slate-400 font-bold uppercase">Expert Report System</p>
                </div>
            </div>
            <div class="flex gap-3">
                <input type="file" ref="fileInput" class="hidden" accept="application/pdf" @change="handleFileUpload">
                
                <div v-if="status === 'idle'">
                    <button @click="$refs.fileInput.click()" class="bg-blue-600 hover:bg-blue-500 px-6 py-2 rounded-full font-bold text-sm transition-all flex items-center gap-2">
                        <span>📄 PDF 업로드 및 분석</span>
                    </button>
                </div>
                
                <div v-else-if="status === 'processing'" class="flex items-center gap-3 bg-slate-800 px-4 py-2 rounded-full border border-slate-700">
                    <span class="animate-spin text-blue-500">⏳</span>
                    <span class="text-xs font-bold text-blue-200">{{ progressText }}</span>
                </div>

                <div v-else class="flex gap-2">
                    <button @click="reset" class="px-4 py-2 text-sm text-slate-400 hover:text-white font-bold">초기화</button>
                    <button @click="downloadPDF" :disabled="isExporting" class="bg-emerald-500 hover:bg-emerald-400 px-6 py-2 rounded-full font-bold text-sm flex items-center gap-2 shadow-lg transition-all">
                        {{ isExporting ? 'PDF 생성 중...' : '📥 전체 리포트 다운로드' }}
                    </button>
                </div>
            </div>
        </nav>

        <main class="py-10 flex flex-col items-center min-h-screen">
            <!-- Initial State -->
            <div v-if="status === 'idle'" class="text-center py-40 bg-white rounded-3xl shadow-sm border border-slate-200 max-w-2xl mx-auto mt-10 p-10">
                <h2 class="text-3xl font-black text-slate-800 mb-4">문서 무결성 진단 시스템</h2>
                <p class="text-slate-500 mb-8">PDF 파일을 업로드하면 3단계 정밀 분석 리포트(표지, 프리미엄 솔루션, 진단 결과)와 재구성된 본문을 생성합니다.</p>
                <button @click="$refs.fileInput.click()" class="bg-slate-900 text-white px-8 py-4 rounded-xl font-bold hover:scale-105 transition-transform">
                    분석 시작하기
                </button>
            </div>

            <!-- Report Preview -->
            <div v-if="pages.length > 0" class="flex flex-col gap-10">

                <!-- PAGE 1: 진단 결과서 (Chart) -->
                <div id="page-1" class="pdf-page p-12">
                    <div class="p3-header flex justify-between items-start">
                        <div>
                            <h2 class="text-2xl font-black text-slate-900">카피클린 진단 결과서</h2>
                            <p class="text-xs text-blue-600 font-bold mt-1 tracking-widest">COPYCLEAN DIAGNOSTIC REPORT</p>
                            <p class="text-xs text-slate-500 mt-2">발급일자: {{ issueDate }}</p>
                        </div>
                        <img :src="logoDataUrl" alt="CopyClean" style="height: 48px; object-fit: contain; margin-top: 8px; margin-right: -5px;">
                    </div>

                    <!-- Meta Info Bar -->
                    <div class="grid grid-cols-4 gap-4 mb-10 mt-4 text-xs bg-slate-50 rounded-lg p-5 border border-slate-200">
                        <div>
                            <div class="text-[10px] text-slate-400 font-bold">REPORT ID</div>
                            <div class="font-bold text-slate-800">{{ reportId }}</div>
                        </div>
                        <div>
                            <div class="text-[10px] text-slate-400 font-bold">문서명</div>
                            <div class="font-bold text-slate-800 truncate">{{ docTitle }}</div>
                        </div>
                        <div>
                            <div class="text-[10px] text-slate-400 font-bold">진단 모델</div>
                            <div class="font-bold text-slate-800">{{ diagModel }}</div>
                        </div>
                        <div>
                            <div class="text-[10px] text-slate-400 font-bold">선택 플랜</div>
                            <div class="font-bold text-blue-600">{{ selectedPlan }}</div>
                        </div>
                    </div>

                    <!-- Dashboard -->
                    <div class="grid grid-cols-2 gap-8 mb-16">
                        <!-- Chart Area -->
                        <div class="relative h-64 w-full flex flex-col items-center justify-center">
                            <h3 class="text-sm font-bold text-slate-700 mb-4 w-full text-left">표절률</h3>
                            <canvas id="rateChart"></canvas>
                        </div>

                        <!-- Verdict Area -->
                        <div class="flex flex-col justify-center">
                            <div :class="['verdict-box mb-6', numericRate > 15 ? 'verdict-danger' : 'verdict-safe']">
                                <div class="text-3xl mb-2">
                                    <svg v-if="numericRate > 15" class="w-8 h-8 mx-auto text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.999L13.732 4.002c-.77-1.333-2.694-1.333-3.464 0L3.34 16.001c-.77 1.332.192 2.999 1.732 2.999z"/></svg>
                                    <span v-else class="text-3xl">✅</span>
                                </div>
                                <h3 class="text-xl font-black mb-1">종합 판정: <span :class="numericRate > 30 ? 'text-red-600' : (numericRate > 15 ? 'text-orange-500' : 'text-green-600')">{{ getVerdictText }}</span></h3>
                                <p class="text-xs opacity-80">종합표절률 <span class="font-bold" :class="numericRate > 30 ? 'text-red-600' : (numericRate > 15 ? 'text-orange-500' : 'text-green-600')">{{ plagiarismRate }}</span>로 기준 수치를 {{ getVerdictDesc }}<br v-if="numericRate > 15">
                                <span v-if="numericRate > 30">신뢰도 확보를 위해 인간화 작업 의뢰 필요</span>
                                <span v-else-if="numericRate > 15">표현 구조 개선을 통한 유사도 저감 권장</span></p>
                            </div>

                            <div class="bg-slate-50 rounded-lg p-4 border border-slate-200">
                                <h4 class="text-xs font-bold text-slate-500 mb-3">&gt; 종합 진단 판정 기준</h4>
                                <div class="flex justify-between gap-2 text-center text-[10px] font-bold">
                                    <div class="bg-white border border-slate-200 flex-1 py-2 rounded"><span class="text-green-600">안전</span><br>15% 이하</div>
                                    <div class="bg-white border border-slate-200 flex-1 py-2 rounded"><span class="text-orange-500">고위험</span><br>15 ~ 30%</div>
                                    <div class="bg-white border border-slate-200 flex-1 py-2 rounded"><span class="text-red-500">부적합</span><br>30% 초과</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Summary -->
                    <div class="grid grid-cols-2 gap-8">
                        <div>
                            <h4 class="border-l-4 border-blue-600 pl-3 text-sm font-bold text-slate-800 mb-4">진단 총평</h4>
                            <ul class="space-y-3 text-xs text-slate-600">
                                <li v-for="(item, idx) in diagnosisSummary" :key="idx" class="flex gap-2">
                                    <span class="bg-blue-100 text-blue-600 font-bold rounded px-1.5 py-0.5 h-fit">{{ idx + 1 }}</span>
                                    <span>{{ item }}</span>
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="border-l-4 border-blue-600 pl-3 text-sm font-bold text-slate-800 mb-4">제출 주의사항</h4>
                            <ul class="list-disc pl-4 space-y-2 text-xs text-slate-600">
                                <li v-for="(item, idx) in submissionNotes" :key="idx">{{ item }}</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Page 1 Footer -->
                    <div style="position:absolute;bottom:0;left:0;right:0;padding:0 48px 28px 48px;">
                        <div style="display:flex;justify-content:flex-end;margin-bottom:6px;">
                            <img :src="originLogoDataUrl" alt="CopyClean" style="height:24px;object-fit:contain;">
                        </div>
                        <div style="height:2px;background:linear-gradient(to right,#1a6b8a,#4a9e3f);margin-bottom:10px;"></div>
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <div>
                                <div style="font-size:10px;font-weight:700;color:#334155;">CopyClean Document Verification Service</div>
                                <div style="font-size:9px;color:#94a3b8;">Generated on {{ generatedTimestamp }}</div>
                            </div>
                            <div style="display:flex;align-items:center;gap:16px;">
                                <span style="font-size:9px;color:#94a3b8;">CopyClean Confidential Analysis Report</span>
                                <span style="font-size:11px;font-weight:700;color:#334155;">1 / {{ 3 + contentPages.length }}</span>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- PAGE 2: 프리미엄 솔루션 (Dark Mode) -->
                <div id="page-2" class="pdf-page" style="padding: 0;">
                    <div class="p2-container">
                        <div class="mb-10">
                            <span class="p2-highlight">PREMIUM SOLUTION</span>
                            <h2 class="text-3xl font-black mt-2 leading-tight">맞춤형 유사도 개선 제안</h2>
                            <p class="text-slate-400 text-sm mt-2">카피클린 전문 에디터팀이 전문성을 유지하며 유사도를 즉각 보정해 드립니다.</p>
                        </div>

                        <div class="flex items-center gap-2 mb-6 bg-slate-800/60 rounded px-4 py-2.5 border border-slate-700/50">
                            <svg class="w-4 h-4 text-slate-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                            <p class="text-[10px] text-slate-500 leading-relaxed">본 서비스는 저자 작성 원문을 기반으로 한 편집 서비스로, 내용 수정·대필은 포함하지 않으며 유사도 개선을 위해 표현 보정만 제공합니다.</p>
                        </div>

                        <div class="grid grid-cols-3 gap-6 mb-10">
                            <div class="p2-card">
                                <p class="text-[10px] font-bold text-slate-400 uppercase mb-2">Improvement Goal</p>
                                <p class="text-2xl font-black text-white">유사도 15%<br>이하</p>
                                <p class="text-[10px] text-slate-500 mt-2">학술 검증 통과 보증</p>
                            </div>
                            <div class="p2-card">
                                <p class="text-[10px] font-bold text-slate-400 uppercase mb-2">Estimated Duration</p>
                                <p class="text-2xl font-black text-white">결제 후 영업일<br>1~2일 이내</p>
                                <p class="text-[10px] text-slate-500 mt-2">Priority 처리 지원</p>
                            </div>
                            <div class="p2-card bg-blue-600 border-blue-500">
                                <p class="text-[10px] font-bold text-blue-200 uppercase mb-2">Final Investment</p>
                                <p class="text-3xl font-black text-white">{{ formattedPrice }}</p>
                                <p class="text-[10px] text-blue-200 mt-2">VAT 및 수수료 일체 포함</p>
                            </div>
                        </div>

                        <div class="p2-card mb-10">
                            <div class="flex justify-between items-center mb-6 border-b border-slate-700 pb-4">
                                <h3 class="text-lg font-bold">서비스 상세 견적 프로세스</h3>
                                <span class="bg-slate-700 text-[10px] font-bold px-2 py-1 rounded">VALIDATED PRICING</span>
                            </div>
                            <div class="space-y-4 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-slate-400">AI 유사도 개선을 포함한 종합 표절률 15% 이하 인간화 작업</span>
                                    <span class="font-bold">₩250,000</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-400">문헌 기반 표절률 개선으로 기준 수치 초과 문제 해결</span>
                                    <span class="font-bold">₩50,000</span>
                                </div>
                                <div class="flex justify-between text-blue-400">
                                    <span class="font-bold">첫 진단 특별 프로모션 적용</span>
                                    <span class="font-bold">- ₩5,000</span>
                                </div>
                            </div>
                        </div>

                        <!-- Payment & QR -->
                        <div class="p2-card flex items-center gap-8">
                            <div class="flex-1">
                                <h4 class="text-blue-400 text-xs font-bold uppercase mb-2 flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>
                                    Payment & Next Steps
                                </h4>
                                <p class="text-sm font-bold mb-4">아래 결제 링크 또는 QR 코드로 결제 후 개선 작업이 시작됩니다.<br>완료 후 개선 결과를 반영한 원문을 메일로 받아보실 수 있습니다.</p>
                                <div class="bg-slate-900 p-3 rounded text-[10px] font-mono truncate border border-slate-700">
                                    <a :href="paymentLink" target="_blank" rel="noopener" style="color:#60a5fa;text-decoration:underline;cursor:pointer;">{{ paymentLink }}</a>
                                </div>
                            </div>
                            <div class="bg-white p-2 rounded-lg">
                                <img :src="qrCodeUrl" alt="Payment QR" class="w-24 h-24">
                                <p class="text-[8px] text-slate-900 text-center font-bold mt-1">SCAN TO PAY</p>
                            </div>
                        </div>

                        <!-- Confidentiality Policy -->
                        <div class="flex items-center gap-4 mt-10 bg-slate-800 rounded-lg px-5 py-4 border border-slate-700">
                            <div class="flex-shrink-0">
                                <svg class="w-8 h-8 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.999L13.732 4.002c-.77-1.333-2.694-1.333-3.464 0L3.34 16.001c-.77 1.332.192 2.999 1.732 2.999z"/></svg>
                            </div>
                            <div>
                                <p class="text-[10px] font-bold text-slate-300 tracking-widest mb-1">CONFIDENTIALITY POLICY</p>
                                <p class="text-[11px] text-slate-400">본 결과서는 의뢰인의 원본 기밀성을 보호하며, 작업 완료 후 문서는 즉시 폐기됩니다.</p>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- PAGE 3: 심층 분석 결과지 (Standard) -->
                <div id="page-3" class="pdf-page p-12">
                    <div class="p1-header flex justify-between items-start mb-6">
                        <div>
                            <div class="text-xs text-slate-500 mb-3">카피클린 디지털 표절 분석 서비스</div>
                            <h1 class="text-3xl font-black text-slate-800">심층 분석 결과지</h1>
                        </div>
                        <img :src="logoDataUrl" alt="CopyClean" style="height: 48px; object-fit: contain;">
                    </div>

                    <div class="flex gap-4 mb-8">
                        <table class="p1-table" style="flex: 1;">
                            <tr>
                                <th>Report ID<br><span class="font-normal text-[10px] text-slate-400">Report ID</span></th>
                                <td class="italic text-sm" style="color: #d1d5db;">자필로 기재하세요</td>
                            </tr>
                            <tr>
                                <th>성명<br><span class="font-normal text-[10px] text-slate-400">Full Name</span></th>
                                <td class="italic text-sm" style="color: #d1d5db;">자필로 기재하세요</td>
                            </tr>
                            <tr>
                                <th>제출 기관<br><span class="font-normal text-[10px] text-slate-400">Submission Organization</span></th>
                                <td class="italic text-sm" style="color: #d1d5db;">자필로 기재하세요</td>
                            </tr>
                            <tr>
                                <th>검사 일련번호<br><span class="font-normal text-[10px] text-slate-400">Inspection No.</span></th>
                                <td>{{ inspectionNo }}</td>
                            </tr>
                            <tr>
                                <th>문서 원본명<br><span class="font-normal text-[10px] text-slate-400">Document Title</span></th>
                                <td class="font-bold">{{ originalDocName }}</td>
                            </tr>
                            <tr>
                                <th>비교 대조군<br><span class="font-normal text-[10px] text-slate-400">Comparison Scale</span></th>
                                <td>{{ comparisonTarget }}</td>
                            </tr>
                            <tr>
                                <th>판정 결과<br><span class="font-normal text-[10px] text-slate-400">Evaluation Result</span></th>
                                <td><span :class="[numericRate > 30 ? 'bg-red-100 text-red-700 border-red-300' : (numericRate > 15 ? 'bg-orange-100 text-orange-700 border-orange-300' : 'bg-green-100 text-green-700 border-green-300'), 'font-bold px-3 py-1 rounded text-sm border']">{{ getVerdictText }}</span></td>
                            </tr>
                        </table>
                        <div :class="['flex flex-col items-center justify-center rounded-lg px-6 py-4', numericRate > 30 ? 'bg-red-50 border border-red-200' : (numericRate > 15 ? 'bg-orange-50 border border-orange-200' : 'bg-green-50 border border-green-200')]" style="min-width: 160px;">
                            <div :class="['text-sm font-bold mb-2', numericRate > 30 ? 'text-red-700' : (numericRate > 15 ? 'text-orange-700' : 'text-green-700')]">표절률</div>
                            <div :class="['text-5xl font-black', numericRate > 30 ? 'text-red-600' : (numericRate > 15 ? 'text-orange-600' : 'text-green-600')]">{{ numericRate }}<span class="text-3xl">%</span></div>
                            <div class="text-xs text-slate-500 mt-3">판정결과</div>
                            <div :class="['text-sm font-bold mt-1', numericRate > 30 ? 'text-red-600' : (numericRate > 15 ? 'text-orange-600' : 'text-green-600')]">{{ getVerdictText }}</div>
                        </div>
                    </div>

                    <!-- Analysis Dashboard -->
                    <div class="mb-4 flex-1">
                        <h3 class="text-lg font-black text-slate-800 mb-3 flex items-center gap-2">
                            <span class="w-1 h-5 bg-blue-600 rounded-full inline-block"></span>
                            상세 분석 대시보드 (Analysis Dashboard)
                        </h3>
                        <div class="grid grid-cols-6 gap-2 mb-4 text-center">
                            <div :class="[numericRate > 30 ? 'bg-red-600' : (numericRate > 15 ? 'bg-orange-500' : 'bg-green-600'), 'text-white rounded-lg py-5 px-2']">
                                <div class="text-xs font-bold">표절률</div>
                                <div class="text-3xl font-black mt-1">{{ plagiarismRate }}</div>
                            </div>
                            <div class="bg-slate-100 rounded-lg py-5 px-2">
                                <div class="text-xs font-bold text-slate-500">전체 문장 수</div>
                                <div class="text-3xl font-black text-slate-800 mt-1">{{ totalSentences }}</div>
                            </div>
                            <div class="bg-slate-100 rounded-lg py-5 px-2">
                                <div class="text-xs font-bold text-slate-500">AI 유사 문장</div>
                                <div class="text-3xl font-black mt-1" style="color:#ea580c;">{{ aiSimilarSentences }}</div>
                            </div>
                            <div class="bg-slate-100 rounded-lg py-5 px-2">
                                <div class="text-xs font-bold text-slate-500">동일한 문장</div>
                                <div class="text-3xl font-black text-red-600 mt-1">{{ identicalSentences }}</div>
                            </div>
                            <div class="bg-slate-100 rounded-lg py-5 px-2">
                                <div class="text-xs font-bold text-slate-500">표절 의심 문장</div>
                                <div class="text-3xl font-black mt-1" style="color:#0d9488;">{{ suspiciousSentences }}</div>
                            </div>
                            <div class="bg-slate-100 rounded-lg py-5 px-2">
                                <div class="text-xs font-bold text-slate-500">인용/출처</div>
                                <div class="text-3xl font-black text-slate-400 mt-1">{{ citationCount }}</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4 flex-1">
                            <!-- 유사성 분석 분포 -->
                            <div class="border border-slate-200 rounded-lg p-5">
                                <h4 class="text-xs font-bold text-slate-700 mb-3 flex items-center gap-1">
                                    <span class="w-2 h-2 bg-green-500 rounded-full"></span> 유사성 분석 분포
                                </h4>
                                <div class="text-[10px] text-slate-500 mb-2">전체 데이터 대조 결과 &nbsp;&nbsp;&nbsp; <span class="font-bold text-slate-800">{{ totalSentences }} 문장 중</span></div>
                                <div class="w-full h-4 rounded-full overflow-hidden flex" style="background: #e2e8f0;">
                                    <div :style="{ width: distributionBar.identical + '%', background: '#dc2626' }" title="동일 문장"></div>
                                    <div :style="{ width: distributionBar.suspicious + '%', background: '#0d9488' }" title="의심 문장"></div>
                                    <div :style="{ width: distributionBar.citation + '%', background: '#94a3b8' }" title="인용/출처"></div>
                                    <div :style="{ width: distributionBar.aiSimilar + '%', background: '#ea580c' }" title="AI 유사"></div>
                                </div>
                                <div class="flex gap-3 mt-2 text-[9px] text-slate-500">
                                    <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full" style="background:#dc2626;"></span>동일 문장</span>
                                    <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full" style="background:#0d9488;"></span>의심 문장</span>
                                    <span class="flex items-center gap-1"><span class="w-2 h-2 bg-slate-400 rounded-full"></span>인용/출처</span>
                                    <span class="flex items-center gap-1"><span class="w-2 h-2 rounded-full" style="background:#ea580c;"></span>AI 유사</span>
                                </div>
                            </div>

                            <!-- 해당 카테고리 비율 -->
                            <div class="border border-slate-200 rounded-lg p-5">
                                <h4 class="text-xs font-bold text-slate-700 mb-3 flex items-center gap-1">
                                    <span class="w-2 h-2 bg-orange-500 rounded-full"></span> 해당 카테고리 비율
                                </h4>
                                <div class="space-y-2">
                                    <template v-for="(cat, cIdx) in categoryRatios" :key="cIdx">
                                        <div class="flex justify-between items-center text-xs">
                                            <span class="text-slate-600">{{ cat.name }}</span>
                                            <span class="font-bold text-slate-800">{{ cat.ratio }}%</span>
                                        </div>
                                        <div class="w-full h-2 bg-slate-100 rounded-full"><div class="h-2 rounded-full bg-slate-800" :style="{ width: cat.ratio + '%' }"></div></div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 하단 면책 문구 및 푸터 -->
                    <div style="position: absolute; bottom: 40px; left: 48px; right: 48px;">
                        <div class="text-[9px] text-slate-400 leading-relaxed mb-2">
                            <p>본 결과지는 CopyClean(카피클린) 분석 시스템이 문서를 자동 대조하여 생성한 참고용 리포트입니다.</p>
                            <p>최종적인 표절 여부 판정은 해당 교육 기관 및 학위의 규정과 과정에 따라 심사위원의 판정하에, 시스템 점수는 참고용으로만 활용됩니다.</p>
                        </div>
                        <div style="display:flex;justify-content:flex-end;margin-bottom:6px;">
                            <img :src="originLogoDataUrl" alt="CopyClean" style="height:24px;object-fit:contain;">
                        </div>
                        <div class="border-t border-slate-200 pt-2 flex justify-between items-end">
                            <div>
                                <p class="text-[10px] font-bold text-slate-600">CopyClean Document Verification Service</p>
                                <p class="text-[9px] text-slate-400">Generated on {{ issueDate }}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-[9px] text-slate-400">CopyClean Confidential Analysis Report</p>
                                <p class="text-sm font-bold text-slate-600">1 / 2</p>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- PAGE 4~: 문장별 정밀 대조 결과 -->
                <template v-if="contentPages.length > 0">
                <div v-for="(page, pIdx) in contentPages" :key="pIdx" :id="'page-' + (pIdx + 4)" class="pdf-page content-padding">
                    <!-- 첫 페이지: 대제목 -->
                    <div v-if="pIdx === 0" style="margin-bottom:12px;">
                        <div class="comp-page-title">문장별 정밀 대조 결과</div>
                        <div class="comp-page-subtitle">Original Text vs Reference Comparison</div>
                        <div class="comp-divider"></div>
                    </div>
                    <!-- 이후 페이지: 간략 헤더 -->
                    <div v-else style="display:flex;justify-content:space-between;border-bottom:1px solid #cbd5e1;padding-bottom:8px;margin-bottom:12px;">
                        <span style="font-weight:700;font-size:13px;color:#334155;">문장별 정밀 대조 결과</span>
                        <span style="font-size:10px;color:#94a3b8;padding-top:3px;">PAGE {{ pIdx + 4 }}</span>
                    </div>

                    <!-- Comparison Cards -->
                    <div v-for="(comp, cIdx) in page.comparisons" :key="cIdx"
                         class="comp-card" :class="comp.type === 'ai_similarity' ? 'card-ai' : 'card-plag'">
                        <!-- Card Header -->
                        <div class="comp-card-hdr">
                            <div class="comp-card-hdr-l">
                                <span>문서 내 서술 문장 (Original Text)</span>
                                <span class="comp-badge comp-badge-l">페이지: {{ comp.pageNum || '-' }}p</span>
                            </div>
                            <div class="comp-card-hdr-r">
                                <span>{{ comp.type === 'ai_similarity' ? 'AI 유사도 (AI Similarity)' : '비교 문헌 (Reference Content)' }}</span>
                                <span class="comp-badge comp-badge-r">문장 유사도: {{ comp.similarity || 0 }}%</span>
                            </div>
                        </div>
                        <!-- Card Body -->
                        <div class="comp-card-body">
                            <!-- Left: 원문 텍스트 -->
                            <div class="comp-card-body-l" v-html="comp.formattedOriginal || comp.originalText"></div>
                            <!-- Right: 출처 / AI 정보 -->
                            <div class="comp-card-body-r">
                                <div class="comp-db-title">{{ comp.type === 'ai_similarity' ? 'AI Pattern Detection' : 'CopyClean DB' }}</div>
                                <!-- 문헌 표절 출처 -->
                                <template v-if="comp.type !== 'ai_similarity'">
                                    <div class="comp-src-box" v-if="comp.source">
                                        <div v-if="comp.source.author"><b>저자 :</b> {{ comp.source.author }}</div>
                                        <div v-if="comp.source.publisher"><b>발행 :</b> {{ comp.source.publisher }}</div>
                                        <div v-if="comp.source.url"><b>URL :</b> <a :href="comp.source.url" target="_blank" rel="noopener" style="color:#3b82f6;word-break:break-all;text-decoration:underline;">{{ comp.source.url }}</a></div>
                                    </div>
                                    <div class="comp-quote" v-if="comp.source && comp.source.matchedText">"{{ comp.source.matchedText }}"</div>
                                    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:auto;padding-top:6px;">
                                        <span style="font-size:9px;color:#94a3b8;">{{ (comp.source && comp.source.fullReference) || '' }}</span>
                                    </div>
                                </template>
                                <!-- AI 유사도 -->
                                <template v-if="comp.type === 'ai_similarity'">
                                    <div class="comp-src-box">
                                        <div><b>탐지 모델 :</b> Curvature·Log-Probability AI Engine</div>
                                        <div><b>패턴 유형 :</b> {{ (comp.source && comp.source.patternType) || 'AI 생성형 문장 패턴 감지됨' }}</div>
                                    </div>
                                    <div class="comp-quote" v-if="comp.source && comp.source.matchedText">"{{ comp.source.matchedText }}"</div>
                                    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:auto;padding-top:6px;">
                                        <span style="font-size:9px;color:#94a3b8;">CopyClean AI Detection v2.1</span>
                                        <span class="comp-match-badge">AI Pattern DB</span>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>

                    <!-- Page Footer -->
                    <div style="display:flex;justify-content:space-between;align-items:center;font-size:9px;color:#94a3b8;border-top:1px solid #e2e8f0;padding-top:8px;margin-top:auto;">
                        <span></span>
                        <span>CopyClean Confidential Analysis Report</span>
                        <span>성균관컨설팅</span>
                    </div>
                </div>
                </template>

            </div>
        </main>
    </div>

    <script>
        console.log("[CopyClean] 스크립트 로드됨 - Vue 앱 생성 시작");
        const { createApp, ref, computed, watch, nextTick, onMounted } = Vue;

        createApp({
            setup() {
                console.log("[CopyClean] setup() 실행됨 - Vue 앱 마운트 성공");
                // ==========================================
                // 1. CONFIGURATION
                // ==========================================
                const apiKey = "AIzaSyBEOYTMppsjq-SMvpnNO5ACcwa-lojoPS8";
                const logoDataUrl = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAAwCAYAAADab77TAAAlMElEQVR42s2cd5RkV33nP/feFyp2de6enumZ6Z4cNGqNMpoZZSEsgcgcwhIMToBhza4Ne+z1AgJsjjHYxyaYZJs1EiJbBglkCRRHo4hGk0eanDrnSu+9e+/+UdXVVdXdE+T12a0+PT31wr3v/sL3F+7v94SJjLUAgtLHWhAgENjyocopLJWDAEJUrseK2jEqN4qq74LaAapHrz1isYiqc7bq+Mz/SnOWvs+emx1TUDu1rRt/9r7ZWernrJy11c8nsNWDV9ODuuPzHaueVVTRp3JcUDvp2Y7XPVzdtbJyqS3TCgFWVC6ZudxWbq5iiK1avLCzRBKiIiSiitFiDlNFzchUCdKMgNnyTzVxK+ybHXxW+Gz5gWz5vtmFIbA1M1fuq/zOFTZs/bPPClJpnXWrqmN6ZT5Rpp2om6Pmelv1186l9xxmzve99iOZZ8g6Gasby9bOKer+YwXW2irCV5+zFQaJ6pmsrdIWW0fOWaZawFpbo3FUM62aeHULsNZWmFMDWTWaaev01pZBp4oyojSPqBMAhKgRwxphteX5xfygJarEdn4Js2dh7kICYGcYXCc1wi4InqJeoKpxz9Y9hJ0BwRIDSpeKMoNq56wmWElzbZkhtlZjasRmVsLnYIAVsybDVsuRqNLwssCJWeLWsteWgaDMPGGrxMDWkdqWhZe5EGqrTIe18ypcZTwBC0rogp8FkKd8TtZjtrU1U1aYNKMFghniVUOlqCxmlg3V38vjVJmMaqbYeewc1I5VAVJBNUhXRhDVQidm/YjZ56iaX8xqop1H+G2VtiLmgtSsANtaCz6zSDEfwWcXL+x82mJnTeSc9S/0ESwIC7MQbec8hKi+sQY+mdUsW9KysrmtrGuui1Krr9ULE1XmbxZCqbNVtTA8a6MrSlj2GWyt9FhbRwZRa0mqRKxyr5ifVLU+QBWD7AIOlp3PPtq544la2tsarbULGE7mNQQLfZy5N4oaFDPlBxZSIKWsPIIxBmMtssYXFRVmWKohss4bFAJh7QKPVfaOK7a+2lOfJaytX5itdX5mbLUQC0u3xZR/q4V7xrTI8jeDtRYpVJWQzuO1WqrWPo93Xe9x2/m1+9xwPJ/gLQznQkemCjBFxYQZY5BSIuUscXRYQBuDkgrl+pXjkdbICtrPs/i6BYoZe1gns5zDBIkq8td6R/MQcJ7xxIzsYDEYpHCRCyCgtWBsiJJu6bsJymZJYsq2fBbi7QLm5Xxs6Plcf74CsKAGVzsiFmMsjqMw1rLjwG6273uRo2MDjAV5QiWJJxJ0NjWycVE31/asZ0mmo6TpZt4AgVpW1no+9pyLqvIEhJ0NyexCocb89JoJ1Uuhk8QRioIZYCj3DGPF58hH/QgiEm4zTf56WrytxJxejo/388TJb3FZ7y601SCaWO7/Nb5IY62pMjm2SgBfCTMunHnnIyhlDZ5VeAkIJXn4wH7+7gd38eyBfRSEwEs3EMuk8RuSyJhPpAxWWdpbG3hP72bed8lWjBAzeQfEjF2sjlyq0VeIslNS62CJakYiEMJW5QHOoanznRe1ds1KSdGO8PyZf2bX8M/JRYMoYXGlwJEWJTWutMRdnyu63s+XfzHJzjP38Dfv7WIiP4kRHfQ1fIekymCsqV3fDEDbV6B056Xw8ynJ2QdzZr6a8t88gk/++hH+4StfIDc0SlNzM8lMhqTroQyIXICLoKG5ATeT5Ewxy7fuupv3XnQNuE4FrsyMbSv7CVLM2vYaB9vO49BUFNRUPPaa7JidD7YX0OSqzFwoIoaDfdz30mfZN/wkaaeRlJ8i5kuSnoMjBFKEGGMphBM8d3oHJweacCOfKEqgdYQhUevy1UREdj6X5ryCG3FWNJs/xp1LEFHnmNkSg2eCf6kkH3/yGb757a9hB0dIJBIYY5gaHaX/+AACD2UMJgiJdEDHhmWMTQ7xni2vQfouQRCiVMk5UUrNebxIawSU7HUFdsWcZIQUYtb2W9BGl5IYFcdJ1GWhZhyx0l9ja7FZCUloixwr7uSXB77IgeGnSXmtRFgmgojx3CJGJiOKUUg6Bu2ZgMaYoV1dz1T2aSLHUogU+XA2NVqjoaJk1WtzRxqBrEn51jLKVGLsmZBLlKlT7QRW/CMhK/Bnq5RHlP2Chbx2h7Kn7DiKe46c5Hv3/QR59ChRLE5kDPnRMRpijbxp242sWdROTEmy2RxHT57myRf34uLyO+9+dyVkmmHs8MQQZ7IjFIKAmOOypLmDpkRzaem6xLBSWGUQxoByKouzOmRoapRARzTHG4j7aTAWVJmqOgIpS8QxVPxgsAgpcISsIac2ISfzB3jy9D3sG3we322kYEImpkHpq3CL7YjIYsI8e4+f4MHsId5w2a1syfRhzKN4XoyithR1tWdfFjEBQiiUmGUsKEBiDVii2XXZ0pNK6aDEXAWwGgxRhWFKVblIBjQhQrgoqWqP2wiBqs2bl5/TsVikkOQLAf/47LME+/ZStBLXWorZPJ1+ks/+4YdZvaizFHpYSxiGZNet5o4bt3Fp3yW0NjURhhGu63Kk/yTffvwBnjp1jDEToQU4GNobGrhqaQ+/fdn1dDV2YK1l5+493PngPbSuWEzcGD665Q5ODA1y156nODo9graGlmSMrctW87tX3sZzT7/IX/7yHtZev5loIod0BB+9+rV0pVswVpdgWBvu3fcih07vwaLJas1vrV/PgeJ29g48S2hjYCwTQZEu9zY2tV1NQklc5RJFEdlijqzOcfPaVzMxNorn+DixGPlQkw8NyqndrJBSUrRjDE4/xGDuCfJ6GKUkzf5KelLvwpc9aFtCrhmGFfUxhgvPMlLYQ2hGQTg0+j10J27Hk8vQJgIB/dO7COxBhIQW/woSzjIic4YjE48wVNiHJ1P0pG+lyb+ohHJzAnmLY41FSdh1eoA9u3ejx8cRUmCMRU9O89EPvZ9rL7mEbC6H7zrV+Q9aW1poakgRhBGe6/DU/t187Dvf4GR2moaWJlTMR0nwGjIMZovc9dRTPPbyfr74xveyoX05R48e49kX9pCUEXZ6mlPDYwyEEVNAIh4HaxkbnOI3Jx/l5ekJNk+l+Nld93Kg3cezirHsBCvbuvndzTcSGYPvujxy8CCfuf/fCMaPMhaFrFrcwdq2GD858K8s6soRGIdimEfpLm5Y+mpaEmk8J4YjSsQ3VpPwU7SnmhgZGsB1fFzfJx9G5EONY3WJtVIQkOXl6Sc4MvI9zkw9i69cHKXQNmK/3cHB5P1s6/wSGedKQDNYOMCRye/x0vi/kwvHygAO2hqEDGmMf5vrur5Im38t333x0+wa/AlL23JMRaNc1P56NrW8hZ8f+V8MTJ8EFJYiCf/L3NHzRVZn3ojWURVcl8MkbQyOgZ0nzzB88jQiCEFIgmKR9tZWbrv+RlKJBKl4vAyrpfyt4zjE/BhhmbnHBvr5r9/4MsdHRmhua2HqxGns6Sn8yDBKnrYtl9Dc3MjxkTH+x31389U7PkAunyctXPxIIK3DgcFBgsk87nCOM6PjpFYupnH1cjwDv3hxF2L5Gq7tXcvh5w7Qfu3l2HyRhw7v53191+IohdGa+/fsIqXzTGnwjeBNGy9l557djI8O0bI0TVg0TEcBm5ouYn3nWqSweI6PFLKS8neVh5KluN71HBzXIx9G5LTFESXEK+ocX33mS8TTz1AMTxFzMkwUJegULUlJzC3QPznEr8yf8oZlP+X5gRf41AMf4uqVhrbWJEo1o0QKX4B0CkwXAwanJ3no9J3c3Lmc4+MnGMsK2pu7iGyS3cM72T26i0I0ScxtI4jAWsl0Icu/HvkcH9ywlYRqxVhTs3HhRFrjYDk1MEQ4OYFjyiYkCFi6YgXLu7vBmsqGgCj/I4VAljcQtNZ89d4f8fLJUzQ1ZhgZGqLPaeK6W7cxXShwcM8+dtz7CM1vuI60G+fFIyf4l2cfY7lUFAsBMhdCqPGKIVfSRKZzMSei0zz240cIbsnStGEVsYLl6TPHWLNxLTt/9SDFKy7ClYrdx47y1MmX2LJ0HbuOHeXZQwcIpyaYLgZkUgnWdy7lF/fdg+rSFLAYIchqS3dmJR2pDoo6jye9mjyAEg4GXcreORIrJbkQcpHFRaCU5Uu/+ht+c+qn3Hp5M0UR4/iY4uiJ5ZwZHGdk+AVefWUb69Y0c3LyNHvG7mYiu5jhIcujuSyb1y7ixECSkWnL0NBLLM0E3HRNF0I0cGLyNHvdf0eYNCNTRaYDKAiD0BHZIGRqLEEilCxqU9h4hA0TDEwN8/L4U1zcdjtWm7I9LjPYGENkNLl8AR0ZlC2HJlqTSqdJxF2CICpJuJi7keQoyd6XXuJXzz6DqxTZfJ6UEXz4Xe+gsaWZyclJOpd0kS0U2Lv7EOmL1uCElif27aWpcTk20phCSKGQpSvZxH+55fUUTciJgSH8VIpfbH+IRE83NtAMjYxxWVcPndZjZOcBmtauYHJwkh+/8Cxblq7jgb17GB/px+SmyOmQW1eso8GPc7p/mFSbIRQCjaCIIe014Ls+1hoc5c6GWLK8JVl2yrUxmMiSjTTTgSFmYNfpnXz3we/x5lsWMRVGZCON1ZtZ27iCtBrh3/Ye4e4f7eNP/2QLgfZ5fuBRupy3cnnvNQznpokme+mJ+yzyNbsLTfzkvn+hNZPhor400zk4MX6CXEFzamSansVtaF+RDw0pex0J08Sze36G4/Zzy7ZeQpFlOrQM5E/NG385WAi1wcVAWIqGrbEgJcMTYwRhiKNU2Uuu328tZb127dvPmaEhRDzGdDbL2u5e1q1aRSEMaEql8D2PQ2tWcXDP0wTZPISGkbExJp0WiCLCYoFivoDb6LG4q4tAhyRicQbWDbP9mcfJDo3hxTyCoIBpllx62RX8ePuvyPR042jDw7ue5+iVN/DUvn2QnSJXDPAcuHXdZnJBQBhZxsdztIsWIguRtWSjSaywCCmrNu6rMtzl+FlrQxhpcpFmOjIYY3l011MMH+/HT3YzHhaJIofOxiKxxqMkilne8dqVZKfSjOQCAutgTZ7lDR7XrdxKYAyIgCk9wFChn77miGWd19OQMQxMFZiKBP3Zacam8gwMZsmFBusIJouSi1vWEUu2MjB8koee/hHLlxVZssJlOrLkwrBu/30mTLKWyBja47FyUkFijEE4HodOnuLlkydYt7yHKNI4UtWFH4Z8Mc/p/kGKxSLK9ygUisR9n872NqZyOaIwQgjobG/DOeAQ5ApEUUCoChSLIdZYdBARFkM8x6GzrZ2pfBZHKpYtXkwmnWY8ly/FsvkATzls2XoNP3/8EaaOnMJPJxkbGeXzP/kBg8ePUCwUmM7nuWTVKjZ197Jv6ChNbR3sP7GTZdFitCnloPeP70QgkEJW4Ggm2TCzOWmMAVOiT1YbctqC0YyeOEUwlmNKRxS1wbGKcb0PKUKEY2hf6oJSFLTGWJgqhCzJLOPE9FGG9ClOhns5kzuMVCG+UGR60hRDwVTekkOQDgOmpgvkJkKKWhBGUNCWpanFZEQXGb8ZKXyCUFDUgkIEgbbzFAiAY60l0oaVbU1k4nGmxiVYjeM45Mcn+dL37+IbH/8zPMcljKKK9kohcJVDTufI5gOEEWAsVmvyUUA85iOlIooiLBbf93HiPtP5PFpH+F4SISQ6MohiRBRECAPxRAyhJFhLKhHHTyURFsJ8gWK2QHu6kbUrl7NhzXp27j5E1zWXQEHz8O5naXFiFIOAYpDnjVdsIRn38aygd9Uatv/bfUwOT+ElfXyZ5PmR7ewf28napospRoXKbtHMnpIjfKwpJRUia8kZS84YrNDoMGRqosDg5DROSqHDkIOnHZROIIXECo0lJLSa6SjLOzZexWMHn+Dbz/0Dq/saGJweRlqXyYFGsiMOZ/YdYN3mZro3tzA8ZWkShnwYUciHFCNDaKCoNUsau2kUHXjSwY07WEeSjyBnILBzK1RmUs9oYFl7K1cu78ZIH0cKIm1QiSTf/NFP+fNvfo2J/DSu65R+HQelFIcHTrJj/y4yDWl84WIwxJXL0YF+hqbG8P3S9Z7jEKHRvkOUL1DIFlgUT5PwfYIwQochURDgOBKpBPGYTyqVIp+bxmnJEEUGnQ8QxZC1i5bQnGng2muuRA9nKY6PY7RGa8Ngdop8IUdXYyu39l1JIQxI+jH6etfhtazm+O4JhAKsJDKGv9n9ZwwFR/GdGK5ycZWLo1wCJ8/xYA+RzKGEQmtDITLktaUYGVJ+mnDacKY/SygFU1GIG7XSMH0FYnwtdmwtzlQfqcKVXJp6J31tN/EX//xXuKpAYDVCeOjxJazRN9OTvpbjL+Q4fWiSSDrkippQW2wA0bQh0hAYCLUk6TUQd2N4QqIciRaSgoZ8JNCmbs+4bHUcIQRKCpKJJG+7ajPb9x+iMNWPDLIYK5COx51f+wY/ffgRbrriMro72skGAS+dPMWjL+zEWsMn3/5eOv0UL4dTOH6M/qFhPv6Nr/AXH/h9OjItDE+OsOPUYQbHJ/Bcl+z4GLdsuoTiZB5jLVEYkBAOTx/Yz/9+5H7edNV1TBcn+c3pwwy7gjCbIzSG7mQDl65dR6FY5Mq+jaxfuoK9+w7TsnoZ0xPTSCGYzhd453VX0d3WzvHh0yTjCVa3drFlw7X8ate/0rRkipbuNG4xzp6hg3zw4Xdy27LXsqpxDUq4nMn1s2t4N0+ceYQ3LH4b0niMZ7NkI0E+AiXyLOvoIplZzIu/Pk7rukuIjKKpa5Kb073Eo8UUdIEJPUl//gTL2hp55tBTHNp1mPYNyyhoy3hQYFPrUm7OXM2OY7vJNPh093QxnQ8INBgJYcEQ5jSRkRSjkmBpa3Achec6GMdS1AE5LclrgbbzFww6QpRyw47jcsnqlbx/21X87c8fxFEGxxaJjEX5MXbtf4ld+/aDUpXqBS8eJ4iK/OSJR3nVxj4O/Pu9xFYuImYT3H3/A+zYuYtVyxZzcmiYl06eJh73OTM2wOsuupzfetVW7vnZz7HWEgUhyhimsnn+8O+/zN//6Ed4jsPhwWHCUOPHPEaHh7nz9W+nvaWVgeEhutrauGHrNey86zuESwpobdHWoJTDm7fdiLYGz3FJeHFaU028pW8rR0dO8uLDz3PJ9QVaumN4hTj946P8/fDXUBIkCmMkoAhlxC/O3I/O9XBw936Wre/FRIoxxjnc9CR9N76KJ372cw4+O0DvJR2cHp/kp/pu1mc2kXCTnJg6xUv5AzzX73G1cwuCGEd2j9Da144wLkfsTk4ne4nc49zy/k04PYKxsUmMAcdRRIFBFw2hNhQjCHTJR5AIHOWAsEQGipEhiCzWyJqStJlNOkdKhVQa11GkU2lef83lhMUi331kOxOFCVw3AqNRiThCSqwQCFnafwojDVN51rZ1cFXfZg4eOcqOo/tQ7WkaMmlOjYxw+MwZHEfhOpLBoSGu6lnHJ9/3+1gp8Hyf0ApsEGKkQE9M4/kuh0dHiYoRnqMwGE729/PeLTfyrtfcTjafJx6L0ZBOc3nfRpY/0MHQwCiqIc341CTbNvVx+Zp1FIo5Yq6H1pqGZJKVHYv5vatexzefgBcf3k/nhkmWLI+RirvE43EiozG2tAGgIwOBw7pYH/1Jn4ljhiN7x1h8UQZZhKdGnuDSNW9mfPR2nnzgSbKhoHddmrFwkgcHHyxlqIQkJGBytMClbRGXb72N7dt/QeMzA3RfnCEbTvOdY9/Cj7kEyjD9dJZFq9qQvsOg6Wc6l0dGYBVE0lLQQamwwi3lHZQWSCOIlCBCEGk9t4IZcIQUSCVxlCLmebS3tvHW669h1eIO7n/6N+w6cZKJqIDWIdaEJcNtISF9ehd18qZ3bONtr76J8ckp3v2WO1i2YzHbd+9iMMgS82PEYj4IQdLxeNO12/id176OzvY2wqCA78cwlpINxtKgfFJjESOTY8hMkrAQ4QjFH2x7DX/8rndhAMdxEVKQTqVoa2oiGXcZd6FQCAjDiHffeBuuqygEAuU4eK5Lwo/R2pTh4qUr+KPY2/j1y8+x49hOdp8cwk8VSDaEJJIOrnKJiwRL/OVs7d7CLcuv47loL09deZLnntnD8ZEsyaRhUaqLzes3su6GTfzguUZ27HiRY4em6e4VpBs9PNdDaUks6OANK+5g26JXkdmym5FAs/uJfQyO5+jscfAdj6Rsxh5PsPPh5zh9pp/m5XFWLk1RjMYJ84Zjp7LkvRy+9PCVh1ISbQ0j+SzHBkdxhaR/dAx6FXUb62UNFqWtPcd18KwlDSjZwbZUik0rejl8ZoBjg0P0j45RLBZxXZfWdJqezjbWr+iho60VCzQ2pNmwspeOtha2XrmZIydPMzadRQpJU6aBDb3LWdvTQzwRx/M8MBGu6xAiQFuCoMjyzsW893U3cvjkKQJjaWnM0Ld2NVdcfBENDWmUUigpsKEh09DAwUOHGIzy5B2XbHaalV1LuP3KVxGGGtdx0Ubge35ZM8HpUCTjMZY0tXPD6ks5NNrPwNQ4+SjAVS7tiQzLmjpY3tpJR3MjkYhY3bWUT1z3Vn5z6jDDkxOkfI9b1l/J6q4lnIkP8aFtjdy87jJe6u9ncHIElbe0NGRY0tBGb3c3Gzt7ScZjbF62lv/5mkaeOvoSh06fQp2KWJJpZnVbL6k1SfrarmOiMMWyxjZet+I6HjdPsWpRH0LF0TrgLVfexPLGZUzlJtnU1ccdm95DUDQEYwHv3LiJt298BzrSpV2q6kRHyclSWKccIssSw33fJ5FI0tLSQl8YEJVDJNdx8FwPx3PxHBfPd/E9D6M1UkpiMZ+2pkbW9faU0n5S4nk+vu/j+zGSiTie56IDhev6CCkx1mK0IRFPsOXyzWy+eAOe45JOJsmk08TiCWK+j1vea/Zch0hr7n/yCfK+Q5AvonN53nDVVpozafKFIkpKhHIqFTVSSJSj8DyPZCpBS1MDaxYtJSLCYBBC4joKz/WIx2IkY3E85RJTcS7qibG6czHGGmKxGPFkDCkEi1rbyCTTtDe1ckXPGrQxIGWJRp5DPO6TiifwlENTQwZXenQ3t1O8KMAai1AK13NQUrKmdwlSClzPQ3mS6ze8is29fRSCAp7nsGLxssq++DUrLmVVywqm8lmkI1i/ZBUNsQaMNnMKDEoQDTgohChtfymlcMrwpo3GmlIGByidl6XzrlfaPUGUGOS4DjHto7XBGFPZwFdK4boevu/jeW4poe8qlJJkrUW5ClOASAoWd3QQaI2jHJTj4Psecd/HdRyEEGhj8H2PXz38KI8d2E1eWgrZaRzP59233o4xJaGSQpYqL6TAcwQSiXJLa/I8j2Q8QRhGpfWV95GllPiuS8zz8V0PiSBwQ3zPJUonsViUVHieiyMlYRQR932CMEEQRKXEiBQlT9f3yuO4CCyOUniOSxAmiHSEAZSSuI5bTonqUvztOviOQxRF+L6LIVMSTMctKYxySMRitDdlaEqncJSL76iSfa7Up89WoTqi5EaXMjqyVElRmtjBGBdjbYVRpWoLhVQlrVdKViotjDK41qmU01b3UykhUcrBcRSyzCSlHFqbGrn2oj6kkgSFgNdeczUtzc3kigGuo0qQrKrmAUQ5V/wvDzxENmtIppK0Nmf44/e+hw29PVVVJTNep0RIB+lKHOOgHRff00RaY4xG21KN90wFqZIKV7o4UiEQeG5EFItKAi5KXqySpXUYqwl1RFgey5azYTP0c5WLEgpjSyYj9CK0NaVUcEVZZKWaxUKJrlLOdnfYUjrVd3wEEkc6pGIJfM8vl0JJPMcrNyTMbZYTURhZW1Xgbq1Fa11JuM9MMFNrXF2KU13PNlNPZEy5VUXKcoWmQUhR3mosC4MxaK2ZnJxkeGQUrQ2JRILuri6koyoLVkohZW0HoJKS6VyOex/6NRPjk/i+x8bVa7h000aMKUlxTdOArepHsqVyWWNLCDNbIGcrzWECgRKqsq9qZ0pkyhWUM2U4JXfVzI5nq9prRAlBZn5KI+gSc62pop+Ys38raprabCWFKstCZcuVIQaLKFf3CaFmN4PqyrVEFEY1penV2lKJqwwIUZJgHWmUo85ZJKi1qWjSfJ8ojAiCgEQsVi6/qapC0QapZKUeq65+jqlsjqmpKcIoIubHSKVSZZPi1HVXzG4BztZ81Ta72bqa8NrGGHv2LiBLuWepugRdzPlrq7pCrLB1Da5zCl3ryuhqOzSpa71b8LytZ3DZEZnKZtn+4k6ccjpSARtWruTuBx/khZdf4psf/wRD42P85sABHNfFVSVIEdayZtly7vznf+KaTZt483U3cPD4Me765S9IJRI1ttt3Fa/feh1NDWkeeeEFIl3KfftKsWppNwk/xp3f/Q6/81u3s3LxkkoNF7ZUPxaEIWEYlZ04hes6OI5TskFi/kLG2crL86lPrSf8Qg1edk7L67kK1itNhkJUsai+G0LMrQwXs30FYqGKzbll5zgVihiDdAVHTp3i9z5zJ9JxcFyXQy+/zLc++1n2HzvOQ889jzaGZ/bu5SOf/wtiiQTZfB7f9ShOTvK3f/IJfvjIo7iuy5uvu55TAwM8ufMFfM8rN65Jhicn2fHiC2z9YR8xz+Uvv/NP5Ms7UI/u3MkXPvpR3n7DjfzVXXdx6xVXsWpJd7l1pKTlEvBcF1c5lQrLEoyLs1Wp1tYrWbEgcWxdb3WpRFss0IAmZrtH66ERUdPMU2GOOPfzzWWiKMNxVc+9WABa6iponZkLhZRYY1nZ3c32b/8TSklODQxw9R/8Po3pNFJKOlrbcJTipsuu4PMf+SO+ft99fOtjH+N9n/sct7/lbbxm61bsV75CQyqFEIIgCEBHCCdRqtyUkiAssnLlCtYu76FYLPK7r30dQRQiEOx46SD5MEAAjZlGHMeZQ1UhBKqsqbam7+sCWkXE2Y8JUc+sBRS3pvNQzFF0MacJvH6cueW3c68Tc3qyxbzPLuZ2fIiq1hWtDa7ncN/jj/Phz3yKhuYWImMxWnPpmjU89PxOXjpyhPd8+lN88SMfJTCG7QcPkEo3sO/0GW7SEa7nl0KHWIyB0VH2Hj3M1ZsvxXUdtLUklMM3jh4jsJpHnn+OJa1tfPDvvsLS5kY2LF/GrZf08erLLy+3hJ29cXKO1vxfav0Q4hUKyJxmeHvu9t3zKJCft8hdnOW6umeoMFiWNXhDby/f+uSnGByf5AOf/jR3vPoWli0qldy4rseS1laS8RjtmQxJ3ycV8/Fcl+6ODoSAMNKk4nFePnqUf/zxT2hqb591brSms7ERqyM++oW/4vMf/ghGCfrWreGajRsYHBvn3scfY/WSpaRTqfOjtuD/w49d+PnsQio4jwGlLuwR9vynnqmLroY+bQwbVq0kk8nwxv/2MS7esI6vfeITABSCkHWrVvHZD36IY4OD3Pv44wyNjvKFH3yfwYkxvv7DHxBls6TicaZzea7ZvJnPfPgP+fIPf0CiIV0qDUVgrCGXzfLDP/8kTQ1pbuvrY3R4mF9u347juiRjMXraO8mH4Vl08mySPPe6BV9HIc6DWK+o6/4sc4jzaUk5f0dwfgNc8wqHmfIbjaMUX/7hD1h20w0sbu/g11//Jp3NzTMF9ChVEoJfP/McDz79NNdu2Mi9jz7OTX2baU6k6B8ewZEKzy21XLZkGmluasJRCiVK0jQ+McWvn32O0FpaGpv4ysf+O9L1ecerX8N3P3knX//En3L1xovoaW+jJZVaADbtBamvfYWab+fcbC9MgcWFwIs4+xTnJWjVXfiiqn203BymtWZ55yLu/usv8dabbwILYRThKsV0IY8RAiUlb9y2lTdv24q1Fs91sVhi8Thjo+N87p7vE4YBACNTk3x/x5O89vLLcFSpfKe9uZG33HIzMc8DUUrrPbZ3D0sWdbJ5/XqCMCQSlq9+6EO0ptOlnK2Qr7CF8j9ml8UrhX9B7dsGxLnaCasgWthz3FentRXorupIEHXdhRW33lpu27Kl3P5jyqlJidGGlnQDukznRDxeSafNZoosgdGsWLSI5nS6lMyIDJ2pBoZHxpGitM3lOg5BLsvLx4/T09XFdD7P2kVdfO+BB/j544+VKjxdh9zkFO9/0xu587c/gA41jpQXAJX2wpyd84XXV9CQfX7T2lfYKmxrtLXyvao3SehI175IyFqsNUhZamYSQlAMAs4MDZNOJWjOZLDV76OasXNCkC3kmZrO0tyYwXMchkbGGB4bI1collOeotLIvaanh3QyweTUNIdPnCAIw8rrLWy5Q3DF0m46W1pK6c//NGdKvAJNP58+3XO99G0ep8raeTNWF/RM9XH8LIMFC78xzZZ3Kig1PZ9FJqUsC4kpv6JIyvmfxdjKRoas1CbPFdBSzvg8VaIe2cSFM/NCFf2VYbc9D6fAXrhgzeOa1GnwOQChvvidBfqtBXU9v3Nf3Sdq+oLnI+1M47ZcQBPs+TkdZxHaC9NucYFe7vkyWVyABy3mt89nIc8CDK56p9Oc+/8ji/t/Cav/yWGveCUMFueAH3tWRD8Xc2fDJLtw3GDPigPiFUrvecYqFxTfiAXGX+hlYf+xF4zVXDcfutrzykQskIU6y5pmOwBnEVHMc30ZIeUCSdILsBPiPBh3PrAkzpOX8z+bmFci7DzX1zNPnPccCzLmggXbnsc8dm58e7YoQVSFWGL29VVy7kRiHslnAaKIee5diNDnu2hxftpdN5Y9L22z84QY59LihQzefFou6pIN5xIEceEZGLsQEtW/H7j0+T8/8RE3cDy4agAAAABJRU5ErkJggg=="; // ⚠️ API Key는 런타임 환경에서 주입됩니다.
                const originLogoDataUrl = "data:image/png;base64,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";
                const paymentLink = ref("https://copyclean.ai/checkout/CP-20260201-8829");
                const servicePrice = ref(295000);
                const reportId = ref("CP-20260201-8829");
                const docTitle = ref("");
                const todayDate = ref(new Date().toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\. /g, '.').replace('.', ''));

                // Page 1 동적 데이터
                const issueDate = ref(new Date().toISOString().slice(0, 10).replace(/-/g, '.'));
                const diagModel = ref("최신 AI 생성문 분석 기준");
                const selectedPlan = ref("베이직 서비스");

                // Page 3 동적 데이터
                const inspectionNo = ref("");
                const originalDocName = ref("");
                const comparisonTarget = ref("현재점수문서 / CopyClean DB");
                const totalSentences = ref(0);
                const aiSimilarSentences = ref(0);
                const identicalSentences = ref(0);
                const suspiciousSentences = ref(0);
                const citationCount = ref(0);
                const categoryRatios = ref([
                    { name: "학술논문 대조 DB", ratio: 62 },
                    { name: "공공기관 및 기업 DB", ratio: 24 },
                    { name: "웹 콘텐츠 / 커뮤니티", ratio: 14 }
                ]);
                const generatedTimestamp = ref("");
                
                // ==========================================
                // 2. STATE
                // ==========================================
                const plagiarismRate = ref("0%");
                const numericRate = ref(0);
                const status = ref('idle');
                const progressText = ref('');
                const contentPages = ref([]);
                const qrCodeUrl = ref('');
                const isExporting = ref(false);
                const pages = ref([]);
                const diagnosisSummary = ref([]);
                const submissionNotes = ref([]);

                // PDF.js Worker 설정 (즉시 실행)
                if (window.pdfjsLib) {
                    window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
                    console.log("[CopyClean] PDF.js Worker 설정 완료");
                } else {
                    console.error("[CopyClean] PDF.js 라이브러리를 찾을 수 없습니다!");
                }

                // ==========================================
                // 3. LOGIC: QR & Chart
                // ==========================================
                const generateQR = async () => {
                    try {
                        qrCodeUrl.value = await QRCode.toDataURL(paymentLink.value);
                    } catch (err) {
                        console.error("QR Generation Error", err);
                    }
                };
                watch(paymentLink, generateQR);

                const renderChart = () => {
                    const ctx = document.getElementById('rateChart');
                    if (!ctx) return;
                    const existingChart = Chart.getChart("rateChart");
                    if (existingChart) existingChart.destroy();

                    // Custom plugin: 바 위에 라벨 표시
                    const barLabelPlugin = {
                        id: 'barLabels',
                        afterDatasetsDraw(chart) {
                            const { ctx: c, data, scales: { x, y } } = chart;
                            data.datasets[0].data.forEach((value, index) => {
                                const xPos = x.getPixelForValue(index);
                                const yPos = y.getPixelForValue(value);
                                c.save();
                                c.textAlign = 'center';
                                c.font = 'bold 14px Noto Sans KR';
                                c.fillStyle = index === 1 ? '#dc2626' : '#64748b';
                                // 동적 초과 칩 + 퍼센트 텍스트 (현재 문서에만)
                                const avgRate = 15;
                                if (index === 1 && value > avgRate) {
                                    const diff = value - avgRate;
                                    const chipText = '+' + diff + '% 초과';
                                    // 칩: 바 상단 바로 위에 배치
                                    c.font = 'bold 10px Noto Sans KR';
                                    const textW = c.measureText(chipText).width;
                                    const labelW = textW + 16, labelH = 20;
                                    const lx = xPos - labelW / 2, ly = yPos - 52;
                                    c.fillStyle = '#f97316';
                                    c.beginPath();
                                    c.roundRect(lx, ly, labelW, labelH, 4);
                                    c.fill();
                                    c.fillStyle = '#fff';
                                    c.fillText(chipText, xPos, ly + 14);
                                    // 퍼센트: 칩 아래, 바 바로 위
                                    c.font = 'bold 14px Noto Sans KR';
                                    c.fillStyle = '#dc2626';
                                    c.fillText(value + '%', xPos, yPos - 8);
                                } else {
                                    c.fillText(value + '%', xPos, yPos - 12);
                                }
                                c.restore();
                            });
                        }
                    };

                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['제출자 평균', '현재 문서'],
                            datasets: [{
                                label: '표절률 (%)',
                                data: [15, numericRate.value],
                                backgroundColor: ['#e2e8f0', '#dc2626'],
                                borderRadius: 4,
                                barPercentage: 0.6
                            }]
                        },
                        plugins: [barLabelPlugin],
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                y: { beginAtZero: true, max: Math.ceil((Math.max(numericRate.value, 15) + 15) / 10) * 10, ticks: { stepSize: 10 }, grid: { borderDash: [5, 5] } },
                                x: { grid: { display: false } }
                            }
                        }
                    });
                };

                // ==========================================
                // 4. COMPUTED HELPERS
                // ==========================================
                const formattedPrice = computed(() => '₩' + servicePrice.value.toLocaleString());
                const getVerdictText = computed(() => numericRate.value > 30 ? "부적합" : (numericRate.value > 15 ? "고위험" : "안전"));
                const getVerdictClass = computed(() => numericRate.value > 15 ? "verdict-danger" : "verdict-safe");
                const getVerdictIcon = computed(() => numericRate.value > 30 ? "🛡️" : "✅");
                const getVerdictDesc = computed(() => numericRate.value > 15 ? "초과" : "미만");
                const distributionBar = computed(() => {
                    const total = totalSentences.value || 1;
                    return {
                        identical: Math.round((identicalSentences.value / total) * 100),
                        suspicious: Math.round((suspiciousSentences.value / total) * 100),
                        citation: Math.round((citationCount.value / total) * 100),
                        aiSimilar: Math.round((aiSimilarSentences.value / total) * 100)
                    };
                });

                // ==========================================
                // 5. AI ANALYSIS LOGIC
                // ==========================================
                const generateDiagnosisReport = async (fullText, rate) => {
                    try {
                        const prompt = `당신은 학술 문서 표절 진단 전문가입니다. 아래는 카피클린(CopyClean) 표절 진단 서비스에서 분석한 문서의 전체 텍스트와 표절률입니다.

표절률: ${rate}%

문서 텍스트 (일부):
${fullText.substring(0, 3000)}

위 정보를 기반으로 아래 JSON 형식으로 응답하세요:
{
  "diagnosisSummary": ["총평1", "총평2", "총평3"],
  "submissionNotes": ["주의사항1", "주의사항2", "주의사항3"]
}

규칙:
- diagnosisSummary: 표절률과 문서 내용을 분석한 진단 총평 3개. 구체적이고 전문적으로 작성.
- submissionNotes: 제출 전 확인해야 할 주의사항 3개. 실질적인 개선 포인트 제시.
- 한국어로 작성. 각 항목은 1문장으로 간결하게.
- 절대 금지 용어: "카피킬러", "CopyKiller", "GPT", "ChatGPT", "AI 의심", "GPT 의심", "AI 생성 의심". 이 단어들은 절대 사용하지 마세요.
- 서비스명은 반드시 "카피클린" 또는 "CopyClean"으로만 표기하세요.
- "AI 유사도"는 사용 가능하지만, "GPT 의심 문장" 같은 표현은 절대 금지입니다.`;

                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: prompt }] }],
                                generationConfig: { responseMimeType: "application/json" }
                            })
                        });
                        const data = await response.json();
                        if (data.error) throw new Error(data.error.message);
                        return JSON.parse(data.candidates[0].content.parts[0].text);
                    } catch (e) {
                        console.error("Diagnosis Report Error:", e);
                        return {
                            diagnosisSummary: [`표절률 ${rate}%로 검출되어 주의가 필요함`, "문서 전반에 대한 표현 구조 점검 권장", "인용 처리 방식 재확인 필요"],
                            submissionNotes: ["유사도가 높은 구간의 표현 재구성 권장", "인용구 및 참고문헌 표기 방식 최종 점검 필요", "문맥상 부자연스러운 연결어구 제거 권장"]
                        };
                    }
                };

                const extractMetadataFromPDF = async (pageImages, fullText) => {
                    try {
                        const prompt = `카피킬러(CopyKiller) 표절 검사 결과 PDF 이미지를 분석하세요.

참고용 PDF 텍스트:
${fullText.substring(0, 3000)}

위 이미지와 텍스트에서 아래 정보를 찾아 JSON으로 응답하세요.

카피킬러 PDF 구조 힌트:
- 1페이지 상단에 "검사결과" 또는 "표절검사 결과" 제목이 있음
- 표에 "검사번호", "문서제목" 또는 "파일명", "표절률" 또는 "유사율", "검사일" 등의 행이 있음
- "표절률"은 큰 숫자로 강조 표시됨 (예: 45%, 23% 등). 원형 차트나 큰 글씨로 표시될 수 있음
- "검사번호"는 보통 숫자만 있거나 영숫자 조합 (예: 12345678, CK-20260101-1234)
- "문서제목" 또는 "파일명"은 .hwp, .hwpx, .docx, .pdf 등 확장자를 포함한 파일명
- 문장 수 관련: "전체 문장", "의심 문장", "동일 문장", "유사 문장", "인용" 등

{
  "reportId": "검사번호 (표에서 '검사번호' 행의 값을 그대로. 숫자만 있어도 그대로 적기)",
  "inspectionNo": "검사 일련번호 (reportId와 같을 수 있음)",
  "documentTitle": "문서 제목 또는 파일명 (확장자 포함, 예: 후기청소년.hwpx)",
  "plagiarismRate": "표절률 숫자만 (% 제외). 반드시 이미지에서 표절률/유사율/복제율 숫자를 찾을 것",
  "totalSentences": 0,
  "aiSimilarSentences": 0,
  "identicalSentences": 0,
  "suspiciousSentences": 0,
  "citationCount": 0,
  "categoryRatios": [{ "name": "카테고리명", "ratio": 0 }],
  "inspectionDate": "YYYY.MM.DD"
}

절대 규칙:
1. 이미지에서 보이는 값을 그대로 읽으세요. 추측 금지.
2. "표절률"은 반드시 찾아야 합니다. 큰 글씨, 원형차트, 또는 표 안에 있습니다.
3. "검사번호"와 "문서제목/파일명"도 반드시 표에서 찾으세요.
4. 숫자 필드는 숫자 타입으로 (문자열 아님)
5. 못 찾은 문자열 필드는 빈 문자열("")로
6. categoryRatios는 카피킬러 결과에서 "출처별 표절률" 또는 카테고리별 비율을 찾으세요. 보통 "학술논문", "공공기관/기업", "웹/커뮤니티", "도서/출판" 등으로 나뉩니다. 찾을 수 없으면 빈 배열([])로 응답하세요.
7. totalSentences, aiSimilarSentences, identicalSentences, suspiciousSentences, citationCount는 반드시 이미지에서 수치를 찾으세요. "전체 문장", "유사 문장", "동일 문장", "의심 문장", "인용/출처" 등의 라벨로 표시되어 있습니다.`;

                        // 이미지 parts 구성 (1-2페이지)
                        const parts = [{ text: prompt }];
                        for (const img of pageImages) {
                            parts.push({ inlineData: { mimeType: "image/jpeg", data: img } });
                        }

                        console.log("[CopyClean] 메타데이터 추출 API 호출 시작, 이미지 수:", pageImages.length);
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts }],
                                generationConfig: { responseMimeType: "application/json" }
                            })
                        });
                        const data = await response.json();
                        console.log("[CopyClean] API 응답 상태:", response.status, "데이터:", JSON.stringify(data).substring(0, 500));
                        if (data.error) throw new Error(data.error.message);
                        const parsed = JSON.parse(data.candidates[0].content.parts[0].text);
                        console.log("[CopyClean] 파싱된 메타데이터:", JSON.stringify(parsed, null, 2));
                        return parsed;
                    } catch (e) {
                        console.error("[CopyClean] Metadata Extraction Error:", e);
                        return null;
                    }
                };

                const replaceBrand = (obj) => {
                    if (typeof obj === 'string') return obj
                        .replace(/카피킬러/g, '카피클린')
                        .replace(/Copy\s*Killer/gi, 'CopyClean')
                        .replace(/GPT\s*의심\s*문장/g, '유사도 의심 문장')
                        .replace(/GPT\s*생성\s*의심/g, '유사도 의심')
                        .replace(/AI\s*생성\s*의심/g, '유사도 의심')
                        .replace(/ChatGPT/gi, 'AI');
                    if (Array.isArray(obj)) return obj.map(replaceBrand);
                    if (typeof obj === 'object' && obj !== null) {
                        for (const key in obj) obj[key] = replaceBrand(obj[key]);
                        return obj;
                    }
                    return obj;
                };

                const analyzeWithGemini = async (imageBase64, pageNum) => {
                    try {
                        const prompt = `당신은 카피킬러(CopyKiller) 표절 검사 결과 PDF의 상세 비교 페이지를 분석하는 전문가입니다.

이 이미지는 표절 검사 결과 PDF의 ${pageNum}페이지입니다.
이 페이지에서 문장별 대조 결과(비교 항목)를 모두 추출하세요.

카피킬러 상세 결과 페이지 구조 힌트:
- 각 비교 항목: 좌측=검사 원문, 우측=비교 출처(문헌 또는 AI 탐지)
- 유사도 퍼센트, 페이지 번호, 원문 텍스트, 강조 부분, 출처 정보 포함
- "AI 유사도", "AI 생성 의심", "GPT 의심" 등으로 표시된 항목은 type="ai_similarity"
- 문헌/논문/출처 기반 유사도는 type="plagiarism"

⚠️ 절대 규칙 — "비교문서정보" 표 완전 무시:
"비교문서정보"라는 제목/헤더가 있는 표(테이블)는 완전히 무시하세요. 이 표는 보통 페이지 상단 또는 문장별 대조 카드 사이에 위치하며, 아래와 같은 열(컬럼)을 포함합니다:
- 검사문서 / 비교문서 (두 열로 구분)
- 문서제목, 파일형식, 등록일, 문서종류, URL, 저자, 발행처 등의 행(row)
이 표는 여러 행에 걸쳐 이어지며, 표의 테두리/경계선이 끝나는 지점까지가 표의 범위입니다.
이 표 안의 어떤 정보(문서제목, URL, 저자, 발행처, 파일형식, 등록일 등)도 절대로 comparisons 배열에 포함하지 마세요.
이 표 안의 URL도 절대로 source.url에 넣지 마세요.
오직 "문장별 대조 비교 카드" (좌측=원문, 우측=비교출처, 유사도% 배지가 있는 카드형 레이아웃)에서만 데이터를 추출하세요.

추출 항목:
1. type: "plagiarism" 또는 "ai_similarity"
2. pageNum: 원본 문서 페이지 번호(숫자). 이미지에 "페이지: Xp" 또는 "X페이지" 형태로 표시됨
3. similarity: 유사도 숫자(% 제외)
4. originalText: 검사 대상 원문 텍스트 전체
5. highlightedText: 원문에서 강조/밑줄/색상 표시된 유사 부분만
6. source 객체:
   - author: 저자명 (문헌 표절 시)
   - publisher: 발행처/학교명, 연도 포함 (문헌 표절 시)
   - matchedText: 비교 문헌 또는 AI에서 일치하는 텍스트
   - fullReference: 전체 출처 참조 문자열
   - url: 문장별 대조 비교 카드의 출처 영역에 표시된 URL/링크만 추출 (비교문서정보 표의 URL은 절대 사용 금지. 없으면 빈 문자열 "")
   - patternType: AI 패턴 유형 (AI 유사도 시, 예: "문장 구조 패턴", "어휘 선택 패턴")
7. caseRef: 케이스 번호 (있으면)

JSON 출력:
{
  "comparisons": [
    {
      "type": "plagiarism",
      "pageNum": 5,
      "similarity": 32,
      "originalText": "원문 전체...",
      "highlightedText": "강조된 부분...",
      "source": { "author": "저자", "publisher": "발행처 연도", "matchedText": "일치 텍스트...", "fullReference": "전체 출처", "url": "https://..." },
      "caseRef": "CC-1024"
    }
  ]
}

규칙:
1. 이미지에서 보이는 값만 추출. 추측하거나 만들어내지 마세요.
2. 비교 결과가 없는 페이지면 빈 배열: {"comparisons": []}
3. "카피킬러"를 "카피클린"으로, "CopyKiller"를 "CopyClean"으로 대체
4. 한 페이지에 여러 비교 항목이 있을 수 있습니다
5. "비교문서정보" 표(검사문서/비교문서 열이 있는 메타정보 테이블)는 비교 항목이 절대 아닙니다. 이 표는 문서제목, 파일형식, 등록일, 문서종류, URL 등 여러 행으로 구성되며, 표의 테두리가 끝날 때까지 전부 하나의 표입니다. 이 표 전체를 무시하세요. 이 표 안의 URL, 문서제목, 저자, 발행처, 파일형식 등 어떤 정보도 comparisons에 포함하지 마세요. 비교문서정보 표의 URL을 source.url로 사용하는 것도 절대 금지입니다.
6. 반드시 JSON만 응답하세요`;

                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{
                                    parts: [
                                        { text: prompt },
                                        { inlineData: { mimeType: "image/jpeg", data: imageBase64 } }
                                    ]
                                }],
                                generationConfig: { responseMimeType: "application/json" }
                            })
                        });

                        const data = await response.json();
                        if (data.error) throw new Error(data.error.message);
                        return JSON.parse(data.candidates[0].content.parts[0].text);
                    } catch (e) {
                        console.error("[CopyClean] 정밀 분석 API Error:", e);
                        return { comparisons: [] };
                    }
                };

                // ==========================================
                // 6. PROCESS: Upload & Analyze
                // ==========================================
                const handleFileUpload = async (e) => {
                    const file = e.target.files[0];
                    if (!file) return;

                    status.value = 'processing';
                    progressText.value = 'QR 코드 생성 중...';
                    console.log("[CopyClean] 파일 업로드 시작:", file.name);
                    await generateQR();
                    console.log("[CopyClean] QR 생성 완료");

                    docTitle.value = file.name;
                    contentPages.value = []; // Reset content pages

                    try {
                        progressText.value = 'PDF 로딩 중...';
                        // Worker 재확인
                        if (window.pdfjsLib && !window.pdfjsLib.GlobalWorkerOptions.workerSrc) {
                            window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
                        }
                        const arrayBuffer = await file.arrayBuffer();
                        console.log("[CopyClean] PDF arrayBuffer 로드 완료, 크기:", arrayBuffer.byteLength);
                        const loadingTask = pdfjsLib.getDocument({ data: arrayBuffer });
                        const pdf = await loadingTask.promise;
                        console.log("[CopyClean] PDF 파싱 완료, 총 페이지:", pdf.numPages);
                        
                        // [수정] 10페이지 제한 설정
                        const maxPages = Math.min(pdf.numPages, 15);
                        
                        let fullTextForRate = "";
                        const summaryPageImages = []; // 1-2페이지 이미지 저장 (메타데이터 추출용)

                        // === STEP 1: 먼저 1-2페이지만 렌더링하여 메타데이터 추출 ===
                        const metaPages = Math.min(pdf.numPages, 2);
                        for (let i = 1; i <= metaPages; i++) {
                            progressText.value = `PDF 요약 페이지 읽는 중... (${i} / ${metaPages})`;
                            const page = await pdf.getPage(i);
                            const viewport = page.getViewport({ scale: 2.0 });
                            const canvas = document.createElement('canvas');
                            const context = canvas.getContext('2d');
                            canvas.height = viewport.height;
                            canvas.width = viewport.width;
                            await page.render({ canvasContext: context, viewport: viewport }).promise;

                            const textContent = await page.getTextContent();
                            fullTextForRate += textContent.items.map(item => item.str).join(" ") + " ";

                            summaryPageImages.push(canvas.toDataURL('image/jpeg').split(',')[1]);
                        }

                        // === STEP 2: 메타데이터 추출 (1-2페이지 이미지 Vision AI) ===
                        progressText.value = 'AI가 표절 검사 결과를 분석 중... (약 10~20초)';
                        console.log("[CopyClean] STEP 2 시작 - 이미지 수:", summaryPageImages.length, "텍스트 길이:", fullTextForRate.length);
                        console.log("[CopyClean] 추출된 텍스트 (앞부분):", fullTextForRate.substring(0, 500));
                        const metadata = await extractMetadataFromPDF(summaryPageImages, fullTextForRate);
                        console.log("[CopyClean] STEP 2 완료 - AI 메타데이터 추출 결과:", JSON.stringify(metadata, null, 2));

                        // 텍스트 정규식 fallback 함수
                        const extractFromText = (text) => {
                            const result = {};
                            // 표절률: "표절률 45%" 또는 "유사율 : 23%" 또는 "복제율:12%" 또는 그냥 큰 숫자%
                            const rateMatch = text.match(/(?:표절률|유사율|복제율|표절율)\s*[:]?\s*(\d{1,3})\s*%/)
                                || text.match(/(\d{1,3})\s*%\s*(?:표절|유사|복제)/);
                            if (rateMatch) result.plagiarismRate = parseInt(rateMatch[1]);
                            // 검사번호
                            const idMatch = text.match(/검사\s*번호\s*[:]?\s*([A-Za-z0-9\-]+)/);
                            if (idMatch) result.reportId = idMatch[1];
                            // 문서제목/파일명 (.hwp, .hwpx, .docx, .pdf, .txt 등)
                            const fileMatch = text.match(/([^\s/\\]{2,}\.(hwpx?|docx?|pdf|txt|pptx?|xlsx?))/i);
                            if (fileMatch) result.documentTitle = fileMatch[1];
                            // 검사일
                            const dateMatch = text.match(/(\d{4})[.\-/](\d{1,2})[.\-/](\d{1,2})/);
                            if (dateMatch) result.inspectionDate = `${dateMatch[1]}.${dateMatch[2].padStart(2,'0')}.${dateMatch[3].padStart(2,'0')}`;
                            // 전체 문장 수
                            const totalMatch = text.match(/전체\s*문장\s*[:]?\s*(\d+)/);
                            if (totalMatch) result.totalSentences = parseInt(totalMatch[1]);
                            return result;
                        };

                        // 텍스트에서 먼저 정규식으로 추출 (기본값)
                        const textMeta = extractFromText(fullTextForRate);
                        console.log("[CopyClean] 텍스트 정규식 추출 결과:", JSON.stringify(textMeta));

                        if (metadata) {
                            // AI 결과 반영 (빈 값이면 텍스트 fallback 사용)
                            // 표절률
                            const rate = metadata.plagiarismRate || textMeta.plagiarismRate;
                            if (rate !== undefined && rate !== "" && rate !== null) {
                                numericRate.value = parseInt(rate) || 0;
                                plagiarismRate.value = numericRate.value + "%";
                            }
                            // Report ID & 검사 번호
                            const rid = metadata.reportId || textMeta.reportId || "";
                            if (rid) reportId.value = String(rid);
                            const iNo = metadata.inspectionNo || rid;
                            if (iNo) inspectionNo.value = String(iNo);
                            // 문서 원본명
                            const dTitle = metadata.documentTitle || textMeta.documentTitle || "";
                            if (dTitle) originalDocName.value = String(dTitle);
                            else originalDocName.value = file.name;
                            // docTitle (Page 3용)도 같이 설정
                            if (dTitle) docTitle.value = String(dTitle);
                            // 문장 통계
                            totalSentences.value = parseInt(metadata.totalSentences || textMeta.totalSentences) || 0;
                            aiSimilarSentences.value = parseInt(metadata.aiSimilarSentences) || 0;
                            identicalSentences.value = parseInt(metadata.identicalSentences) || 0;
                            suspiciousSentences.value = parseInt(metadata.suspiciousSentences) || 0;
                            citationCount.value = parseInt(metadata.citationCount) || 0;
                            // 카테고리 비율
                            if (metadata.categoryRatios && metadata.categoryRatios.length > 0) {
                                categoryRatios.value = metadata.categoryRatios.map(c => ({
                                    name: String(c.name),
                                    ratio: parseInt(c.ratio) || 0
                                }));
                            } else {
                                // AI가 카테고리 비율을 못 찾은 경우 자동 생성 (합계 100%)
                                const r1 = 62, r2 = 24, r3 = 14;
                                categoryRatios.value = [
                                    { name: "학술논문 대조 DB", ratio: r1 },
                                    { name: "공공기관 및 기업 DB", ratio: r2 },
                                    { name: "웹 콘텐츠 / 커뮤니티", ratio: r3 }
                                ];
                            }
                            // 검사 일자
                            const iDate = metadata.inspectionDate || textMeta.inspectionDate || "";
                            if (iDate) issueDate.value = String(iDate);
                            console.log("[CopyClean] 반영 완료 - 표절률:", numericRate.value, "문서명:", originalDocName.value, "Report ID:", reportId.value);
                        } else {
                            console.warn("[CopyClean] AI 메타데이터 추출 실패, 텍스트 fallback만 사용");
                            // 텍스트 결과로 채우기
                            if (textMeta.plagiarismRate) {
                                numericRate.value = textMeta.plagiarismRate;
                                plagiarismRate.value = textMeta.plagiarismRate + "%";
                            }
                            if (textMeta.reportId) {
                                reportId.value = textMeta.reportId;
                                inspectionNo.value = textMeta.reportId;
                            }
                            if (textMeta.documentTitle) {
                                originalDocName.value = textMeta.documentTitle;
                                docTitle.value = textMeta.documentTitle;
                            } else {
                                originalDocName.value = file.name;
                            }
                            if (textMeta.inspectionDate) issueDate.value = textMeta.inspectionDate;
                            if (textMeta.totalSentences) totalSentences.value = textMeta.totalSentences;
                            // 카테고리 비율 자동 생성 (합계 100%)
                            categoryRatios.value = [
                                { name: "학술논문 대조 DB", ratio: 62 },
                                { name: "공공기관 및 기업 DB", ratio: 24 },
                                { name: "웹 콘텐츠 / 커뮤니티", ratio: 14 }
                            ];
                        }

                        // === STEP 3: 나머지 페이지 텍스트 추출 (진단 총평용) ===
                        for (let i = metaPages + 1; i <= maxPages; i++) {
                            progressText.value = `텍스트 추출 중... (${i} / ${maxPages} 페이지)`;
                            const page = await pdf.getPage(i);
                            const textContent = await page.getTextContent();
                            fullTextForRate += textContent.items.map(item => item.str).join(" ") + " ";
                        }

                        // === STEP 3.5: 페이지별 문장 대조 정밀 분석 ===
                        const allComparisons = [];
                        let caseCounter = 1000;
                        for (let i = 1; i <= maxPages; i++) {
                            progressText.value = `AI 정밀 분석 중... (${i} / ${maxPages} 페이지)`;
                            const page = await pdf.getPage(i);
                            const viewport = page.getViewport({ scale: 2.0 });
                            const canvas = document.createElement('canvas');
                            const context = canvas.getContext('2d');
                            canvas.height = viewport.height;
                            canvas.width = viewport.width;
                            await page.render({ canvasContext: context, viewport: viewport }).promise;
                            const imageBase64 = canvas.toDataURL('image/jpeg').split(',')[1];
                            if (i > 1) await new Promise(r => setTimeout(r, 1000));
                            const aiResult = await analyzeWithGemini(imageBase64, i);
                            if (aiResult && aiResult.comparisons && aiResult.comparisons.length > 0) {
                                const processed = replaceBrand(aiResult.comparisons);
                                processed.forEach(comp => {
                                    if (!comp.caseRef) comp.caseRef = `CC-${++caseCounter}`;
                                    // 강조 텍스트 포맷팅 (hl 클래스는 card-plag/card-ai 부모에 의해 색상 결정)
                                    if (comp.highlightedText && comp.originalText) {
                                        if (comp.originalText.includes(comp.highlightedText)) {
                                            comp.formattedOriginal = comp.originalText.replace(
                                                comp.highlightedText,
                                                `<span class="hl">${comp.highlightedText}</span>`
                                            );
                                        } else {
                                            comp.formattedOriginal = comp.originalText;
                                        }
                                    }
                                });
                                allComparisons.push(...processed);
                            }
                        }
                        // 1차: 넉넉하게 모든 카드를 한 페이지에 넣어 렌더링
                        contentPages.value = [{ comparisons: allComparisons }];
                        console.log("[CopyClean] 정밀 분석 완료 - 총 비교 항목:", allComparisons.length);

                        // 렌더 후 실제 높이 기반으로 페이지 재배치
                        await nextTick();
                        const PAGE_HEIGHT = 1123; // pdf-page 높이
                        const PADDING_V = 28 * 2; // content-padding 상하
                        const FOOTER_H = 30; // 푸터 높이 여유
                        const FIRST_HEADER_H = 60; // 첫 페이지 대제목 영역
                        const SUB_HEADER_H = 35; // 이후 페이지 간략 헤더

                        // 임시 렌더된 카드들의 실제 높이 측정
                        const tempPage = document.getElementById('page-4');
                        const cardEls = tempPage ? tempPage.querySelectorAll('.comp-card') : [];
                        const cardHeights = [];
                        cardEls.forEach(el => {
                            const style = window.getComputedStyle(el);
                            const mb = parseFloat(style.marginBottom) || 0;
                            cardHeights.push(el.offsetHeight + mb);
                        });

                        // 높이 기반 페이지 분배
                        const newPages = [];
                        let currentComps = [];
                        let usedHeight = 0;
                        let isFirstPage = true;

                        for (let i = 0; i < allComparisons.length; i++) {
                            const headerH = isFirstPage ? FIRST_HEADER_H : SUB_HEADER_H;
                            const availableH = PAGE_HEIGHT - PADDING_V - FOOTER_H - headerH;
                            const cardH = cardHeights[i] || 200; // fallback

                            if (usedHeight + cardH > availableH && currentComps.length > 0) {
                                newPages.push({ comparisons: [...currentComps] });
                                currentComps = [];
                                usedHeight = 0;
                                isFirstPage = false;
                            }
                            currentComps.push(allComparisons[i]);
                            usedHeight += cardH;
                        }
                        if (currentComps.length > 0) {
                            newPages.push({ comparisons: currentComps });
                        }

                        contentPages.value = newPages;
                        console.log("[CopyClean] 동적 페이지 배치 완료 -", newPages.length, "페이지, 카드별 높이:", cardHeights);

                        // 문서명 (페이지1용 - 확장자 없이)
                        if (!docTitle.value) docTitle.value = file.name;

                        // 날짜 설정
                        const now = new Date();
                        const dateStr = `${now.getFullYear()}.${String(now.getMonth()+1).padStart(2,'0')}.${String(now.getDate()).padStart(2,'0')}`;
                        const timeStr = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}`;
                        if (!issueDate.value) issueDate.value = dateStr;
                        generatedTimestamp.value = `${dateStr} ${timeStr}`;

                        // Report ID 자동 생성 (PDF에서 못 찾은 경우)
                        if (!reportId.value || reportId.value === "CP-20260201-8829") {
                            reportId.value = `CP-${dateStr.replace(/\./g, '')}-${String(Math.floor(Math.random() * 9000) + 1000)}`;
                        }

                        // 진단 총평 / 제출 주의사항 AI 생성
                        progressText.value = 'AI 진단 총평 생성 중... (약 10~20초)';
                        console.log("[CopyClean] STEP 4 시작 - 진단 리포트 생성, 표절률:", numericRate.value);
                        const diagReport = await generateDiagnosisReport(fullTextForRate, numericRate.value);
                        console.log("[CopyClean] STEP 4 완료 - 진단 리포트:", JSON.stringify(diagReport, null, 2));
                        diagnosisSummary.value = replaceBrand(diagReport.diagnosisSummary || []);
                        submissionNotes.value = replaceBrand(diagReport.submissionNotes || []);

                        // 뷰 활성화
                        pages.value = [1, 2, 3];
                        status.value = 'complete';

                        // 차트 렌더링
                        await nextTick();
                        renderChart();

                    } catch (err) {
                        alert("분석 중 오류가 발생했습니다: " + err.message);
                        status.value = 'idle';
                    }
                };

                // ==========================================
                // 7. PDF EXPORT
                // ==========================================
                const downloadPDF = () => {
                    // ★ html2canvas 완전 포기 - 브라우저 네이티브 인쇄 기능 사용
                    // 스크롤 오프셋 문제가 원천적으로 불가능
                    window.print();
                };

                const reset = () => {
                    status.value = 'idle';
                    pages.value = [];
                    contentPages.value = [];
                    diagnosisSummary.value = [];
                    submissionNotes.value = [];
                    numericRate.value = 0;
                    plagiarismRate.value = "0%";
                    reportId.value = "";
                    docTitle.value = "";
                    inspectionNo.value = "";
                    originalDocName.value = "";
                    totalSentences.value = 0;
                    aiSimilarSentences.value = 0;
                    identicalSentences.value = 0;
                    suspiciousSentences.value = 0;
                    citationCount.value = 0;
                    categoryRatios.value = [
                        { name: "학술논문 대조 DB", ratio: 62 },
                        { name: "공공기관 및 기업 DB", ratio: 24 },
                        { name: "웹 콘텐츠 / 커뮤니티", ratio: 14 }
                    ];
                    issueDate.value = new Date().toISOString().slice(0, 10).replace(/-/g, '.');
                    generatedTimestamp.value = "";
                };

                return {
                    paymentLink, servicePrice, reportId, docTitle, todayDate, logoDataUrl,
                    plagiarismRate, numericRate, status, progressText, isExporting,
                    pages, contentPages, qrCodeUrl,
                    diagnosisSummary, submissionNotes,
                    issueDate, diagModel, selectedPlan,
                    inspectionNo, originalDocName, comparisonTarget,
                    totalSentences, aiSimilarSentences, identicalSentences, suspiciousSentences, citationCount,
                    categoryRatios, generatedTimestamp, distributionBar,
                    formattedPrice, getVerdictText, getVerdictClass, getVerdictIcon, getVerdictDesc,
                    handleFileUpload, downloadPDF, reset
                };
            }
        }).mount('#app');
    </script>
</body>
</html>